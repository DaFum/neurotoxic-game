
> neurotoxic-game@0.0.0 test
> node --test --import tsx --experimental-test-module-mocks

TAP version 13
# Subtest: Action Creators
    # Subtest: createChangeSceneAction
        # Subtest: should create correct action
        ok 1 - should create correct action
          ---
          duration_ms: 0.903029
          type: 'test'
          ...
        1..1
    ok 1 - createChangeSceneAction
      ---
      duration_ms: 1.768802
      type: 'suite'
      ...
    # Subtest: createUpdatePlayerAction
        # Subtest: should create correct action
        ok 1 - should create correct action
          ---
          duration_ms: 0.595102
          type: 'test'
          ...
        1..1
    ok 2 - createUpdatePlayerAction
      ---
      duration_ms: 0.750766
      type: 'suite'
      ...
    # Subtest: createUpdateBandAction
        # Subtest: should create correct action
        ok 1 - should create correct action
          ---
          duration_ms: 0.390125
          type: 'test'
          ...
        1..1
    ok 3 - createUpdateBandAction
      ---
      duration_ms: 0.721618
      type: 'suite'
      ...
    # Subtest: createUpdateSocialAction
        # Subtest: should create correct action
        ok 1 - should create correct action
          ---
          duration_ms: 0.297227
          type: 'test'
          ...
        1..1
    ok 4 - createUpdateSocialAction
      ---
      duration_ms: 0.433799
      type: 'suite'
      ...
    # Subtest: createUpdateSettingsAction
        # Subtest: should create correct action
        ok 1 - should create correct action
          ---
          duration_ms: 0.358808
          type: 'test'
          ...
        1..1
    ok 5 - createUpdateSettingsAction
      ---
      duration_ms: 0.562718
      type: 'suite'
      ...
    # Subtest: createSetMapAction
        # Subtest: should create correct action
        ok 1 - should create correct action
          ---
          duration_ms: 0.21447
          type: 'test'
          ...
        1..1
    ok 6 - createSetMapAction
      ---
      duration_ms: 0.33724
      type: 'suite'
      ...
    # Subtest: createSetGigAction
        # Subtest: should create correct action
        ok 1 - should create correct action
          ---
          duration_ms: 0.224313
          type: 'test'
          ...
        1..1
    ok 7 - createSetGigAction
      ---
      duration_ms: 0.39061
      type: 'suite'
      ...
    # Subtest: createStartGigAction
        # Subtest: should create correct action
        ok 1 - should create correct action
          ---
          duration_ms: 0.214736
          type: 'test'
          ...
        1..1
    ok 8 - createStartGigAction
      ---
      duration_ms: 0.321054
      type: 'suite'
      ...
    # Subtest: createSetSetlistAction
        # Subtest: should create correct action
        ok 1 - should create correct action
          ---
          duration_ms: 0.330222
          type: 'test'
          ...
        1..1
    ok 9 - createSetSetlistAction
      ---
      duration_ms: 0.548685
      type: 'suite'
      ...
    # Subtest: createSetLastGigStatsAction
        # Subtest: should create correct action
        ok 1 - should create correct action
          ---
          duration_ms: 0.347107
          type: 'test'
          ...
        1..1
    ok 10 - createSetLastGigStatsAction
      ---
      duration_ms: 0.468371
      type: 'suite'
      ...
    # Subtest: createSetActiveEventAction
        # Subtest: should create correct action with event
        ok 1 - should create correct action with event
          ---
          duration_ms: 0.236265
          type: 'test'
          ...
        # Subtest: should create correct action with null
        ok 2 - should create correct action with null
          ---
          duration_ms: 0.142067
          type: 'test'
          ...
        1..2
    ok 11 - createSetActiveEventAction
      ---
      duration_ms: 0.516655
      type: 'suite'
      ...
    # Subtest: createAddToastAction
        # Subtest: should create correct action with default type
        ok 1 - should create correct action with default type
          ---
          duration_ms: 0.307825
          type: 'test'
          ...
        # Subtest: should create correct action with custom type
        ok 2 - should create correct action with custom type
          ---
          duration_ms: 0.192916
          type: 'test'
          ...
        1..2
    ok 12 - createAddToastAction
      ---
      duration_ms: 0.627569
      type: 'suite'
      ...
    # Subtest: createRemoveToastAction
        # Subtest: should create correct action
        ok 1 - should create correct action
          ---
          duration_ms: 0.175567
          type: 'test'
          ...
        1..1
    ok 13 - createRemoveToastAction
      ---
      duration_ms: 0.260994
      type: 'suite'
      ...
    # Subtest: createSetGigModifiersAction
        # Subtest: should create correct action with object
        ok 1 - should create correct action with object
          ---
          duration_ms: 0.192313
          type: 'test'
          ...
        # Subtest: should create correct action with function
        ok 2 - should create correct action with function
          ---
          duration_ms: 0.127929
          type: 'test'
          ...
        1..2
    ok 14 - createSetGigModifiersAction
      ---
      duration_ms: 0.434433
      type: 'suite'
      ...
    # Subtest: createLoadGameAction
        # Subtest: should create correct action
        ok 1 - should create correct action
          ---
          duration_ms: 0.185193
          type: 'test'
          ...
        1..1
    ok 15 - createLoadGameAction
      ---
      duration_ms: 0.274788
      type: 'suite'
      ...
    # Subtest: createResetStateAction
        # Subtest: should create correct action
        ok 1 - should create correct action
          ---
          duration_ms: 0.229088
          type: 'test'
          ...
        1..1
    ok 16 - createResetStateAction
      ---
      duration_ms: 3.055504
      type: 'suite'
      ...
    # Subtest: createApplyEventDeltaAction
        # Subtest: should create correct action
        ok 1 - should create correct action
          ---
          duration_ms: 0.169568
          type: 'test'
          ...
        1..1
    ok 17 - createApplyEventDeltaAction
      ---
      duration_ms: 0.250033
      type: 'suite'
      ...
    # Subtest: createPopPendingEventAction
        # Subtest: should create correct action
        ok 1 - should create correct action
          ---
          duration_ms: 0.14093
          type: 'test'
          ...
        1..1
    ok 18 - createPopPendingEventAction
      ---
      duration_ms: 0.211211
      type: 'suite'
      ...
    # Subtest: createConsumeItemAction
        # Subtest: should create correct action
        ok 1 - should create correct action
          ---
          duration_ms: 0.196975
          type: 'test'
          ...
        1..1
    ok 19 - createConsumeItemAction
      ---
      duration_ms: 0.278826
      type: 'suite'
      ...
    # Subtest: createAdvanceDayAction
        # Subtest: should create correct action
        ok 1 - should create correct action
          ---
          duration_ms: 0.139703
          type: 'test'
          ...
        1..1
    ok 20 - createAdvanceDayAction
      ---
      duration_ms: 0.205106
      type: 'suite'
      ...
    1..20
ok 1 - Action Creators
  ---
  duration_ms: 14.770177
  type: 'suite'
  ...
# Subtest: getPreferredAudioContextState prefers raw context state
ok 2 - getPreferredAudioContextState prefers raw context state
  ---
  duration_ms: 1.230013
  type: 'test'
  ...
# Subtest: getPreferredAudioContextState falls back to tone context state
ok 3 - getPreferredAudioContextState falls back to tone context state
  ---
  duration_ms: 0.193998
  type: 'test'
  ...
# Subtest: getPreferredAudioContextState returns unknown when no state exists
ok 4 - getPreferredAudioContextState returns unknown when no state exists
  ---
  duration_ms: 0.152507
  type: 'test'
  ...
# Subtest: canResumeAudioContextState only allows resumable states
ok 5 - canResumeAudioContextState only allows resumable states
  ---
  duration_ms: 0.197701
  type: 'test'
  ...
# Subtest: isClosedAudioContextState only matches closed state
ok 6 - isClosedAudioContextState only matches closed state
  ---
  duration_ms: 0.256179
  type: 'test'
  ...
# Subtest: calculateGigTimeMs
ok 7 - calculateGigTimeMs # SKIP Skipping audio engine tests due to environment limitations: (intermediate value).glob is not a function
  ---
  duration_ms: 1.407464
  type: 'test'
  ...
# Subtest: hasAudioAsset
ok 8 - hasAudioAsset # SKIP Skipping audio engine tests due to environment limitations: (intermediate value).glob is not a function
  ---
  duration_ms: 0.20912
  type: 'test'
  ...
# Subtest: calculateGigPlaybackWindow
ok 9 - calculateGigPlaybackWindow # SKIP Skipping audio engine tests due to environment limitations: (intermediate value).glob is not a function
  ---
  duration_ms: 0.25865
  type: 'test'
  ...
# (node:5078) ExperimentalWarning: Module mocking is an experimental feature and might change at any time
# (Use `node --trace-warnings ...` to show where the warning was created)
# [AudioSystem] stopMusic called (was playing: nothing).
# [AudioSystem] Ambient started via OGG buffer playback.
# Subtest: AudioManager Tests
    # Subtest: initializes with default values
    ok 1 - initializes with default values
      ---
      duration_ms: 0.972204
      type: 'test'
      ...
    # Subtest: setMusicVolume updates volume and calls engine
    ok 2 - setMusicVolume updates volume and calls engine
      ---
      duration_ms: 0.32546
      type: 'test'
      ...
    # Subtest: toggleMute updates mute state
    ok 3 - toggleMute updates mute state
      ---
      duration_ms: 0.264576
      type: 'test'
      ...
    # Subtest: startAmbient calls playRandomAmbientOgg
    ok 4 - startAmbient calls playRandomAmbientOgg
      ---
      duration_ms: 1.823452
      type: 'test'
      ...
    1..4
ok 10 - AudioManager Tests
  ---
  duration_ms: 43.553159
  type: 'test'
  ...
# [audioEngine] Asset basename conflict for "song.ogg". Keeping "/assets/audio/song.ogg" and ignoring "/assets/sfx/song.ogg".
# Subtest: normalizeMidiPlaybackOptions
    # Subtest: uses defaults when options are undefined
    ok 1 - uses defaults when options are undefined
      ---
      duration_ms: 1.940306
      type: 'test'
      ...
    # Subtest: respects explicit clean playback flag
    ok 2 - respects explicit clean playback flag
      ---
      duration_ms: 0.340921
      type: 'test'
      ...
    # Subtest: accepts a valid onEnded callback
    ok 3 - accepts a valid onEnded callback
      ---
      duration_ms: 0.195545
      type: 'test'
      ...
    # Subtest: normalizes stopAfterSeconds
    ok 4 - normalizes stopAfterSeconds
      ---
      duration_ms: 0.354923
      type: 'test'
      ...
    # Subtest: accepts a startTimeSec override
    ok 5 - accepts a startTimeSec override
      ---
      duration_ms: 0.217726
      type: 'test'
      ...
    1..5
ok 11 - normalizeMidiPlaybackOptions
  ---
  duration_ms: 4.834784
  type: 'test'
  ...
# Subtest: encodePublicAssetPath
    # Subtest: encodes spaces and preserves slashes
    ok 1 - encodes spaces and preserves slashes
      ---
      duration_ms: 0.331778
      type: 'test'
      ...
    # Subtest: handles leading slashes
    ok 2 - handles leading slashes
      ---
      duration_ms: 1.948744
      type: 'test'
      ...
    # Subtest: returns empty string for invalid input
    ok 3 - returns empty string for invalid input
      ---
      duration_ms: 0.376042
      type: 'test'
      ...
    # Subtest: encodes special characters safely
    ok 4 - encodes special characters safely
      ---
      duration_ms: 0.209763
      type: 'test'
      ...
    1..4
ok 12 - encodePublicAssetPath
  ---
  duration_ms: 3.951033
  type: 'test'
  ...
# Subtest: resolveAssetUrl for MIDI files
    # Subtest: prefers bundled URLs
    ok 1 - prefers bundled URLs
      ---
      duration_ms: 0.420227
      type: 'test'
      ...
    # Subtest: resolves bundled URLs via basename
    ok 2 - resolves bundled URLs via basename
      ---
      duration_ms: 0.207211
      type: 'test'
      ...
    # Subtest: falls back to public path when missing
    ok 3 - falls back to public path when missing
      ---
      duration_ms: 0.251535
      type: 'test'
      ...
    # Subtest: normalizes relative filenames and encodes spaces
    ok 4 - normalizes relative filenames and encodes spaces
      ---
      duration_ms: 0.178263
      type: 'test'
      ...
    # Subtest: supports custom public base path
    ok 5 - supports custom public base path
      ---
      duration_ms: 0.130841
      type: 'test'
      ...
    # Subtest: supports relative base path defaults
    ok 6 - supports relative base path defaults
      ---
      duration_ms: 0.119592
      type: 'test'
      ...
    # Subtest: returns nulls for empty filename
    ok 7 - returns nulls for empty filename
      ---
      duration_ms: 0.139539
      type: 'test'
      ...
    1..7
ok 13 - resolveAssetUrl for MIDI files
  ---
  duration_ms: 2.201265
  type: 'test'
  ...
# Subtest: resolveAssetUrl
    # Subtest: resolves bundled URLs for non-MIDI assets
    ok 1 - resolves bundled URLs for non-MIDI assets
      ---
      duration_ms: 0.156107
      type: 'test'
      ...
    # Subtest: resolves via basename for nested paths
    ok 2 - resolves via basename for nested paths
      ---
      duration_ms: 0.139328
      type: 'test'
      ...
    # Subtest: falls back to public path for missing assets
    ok 3 - falls back to public path for missing assets
      ---
      duration_ms: 0.152456
      type: 'test'
      ...
    1..3
ok 14 - resolveAssetUrl
  ---
  duration_ms: 0.824851
  type: 'test'
  ...
# Subtest: buildAssetUrlMap
    # Subtest: stores relative paths and basenames
    ok 1 - stores relative paths and basenames
      ---
      duration_ms: 0.37254
      type: 'test'
      ...
    # Subtest: warns on basename conflicts and keeps first entry
    ok 2 - warns on basename conflicts and keeps first entry
      ---
      duration_ms: 0.450834
      type: 'test'
      ...
    1..2
ok 15 - buildAssetUrlMap
  ---
  duration_ms: 1.114163
  type: 'test'
  ...
# Subtest: buildAssetUrlMap OGG key filtering
    # Subtest: full paths and basenames are both stored for OGG assets
    ok 1 - full paths and basenames are both stored for OGG assets
      ---
      duration_ms: 0.179303
      type: 'test'
      ...
    # Subtest: full paths with subdirectories are distinguishable from basenames
    ok 2 - full paths with subdirectories are distinguishable from basenames
      ---
      duration_ms: 1.002167
      type: 'test'
      ...
    # Subtest: path-containing keys can be filtered from basename-only keys
    ok 3 - path-containing keys can be filtered from basename-only keys
      ---
      duration_ms: 0.377018
      type: 'test'
      ...
    # Subtest: root-level assets have no slash in key
    ok 4 - root-level assets have no slash in key
      ---
      duration_ms: 0.207379
      type: 'test'
      ...
    1..4
ok 16 - buildAssetUrlMap OGG key filtering
  ---
  duration_ms: 2.312778
  type: 'test'
  ...
# Subtest: buildMidiUrlMap
    # Subtest: stores relative paths and basenames
    ok 1 - stores relative paths and basenames
      ---
      duration_ms: 0.325797
      type: 'test'
      ...
    # Subtest: warns on basename conflicts and keeps first entry
    ok 2 - warns on basename conflicts and keeps first entry
      ---
      duration_ms: 0.330291
      type: 'test'
      ...
    1..2
ok 17 - buildMidiUrlMap
  ---
  duration_ms: 0.952604
  type: 'test'
  ...
# Subtest: selectRandomItem
    # Subtest: returns null for invalid or empty inputs
    ok 1 - returns null for invalid or empty inputs
      ---
      duration_ms: 0.979366
      type: 'test'
      ...
    # Subtest: returns a stable item with deterministic rng
    ok 2 - returns a stable item with deterministic rng
      ---
      duration_ms: 0.231401
      type: 'test'
      ...
    # Subtest: clamps rng values to valid indices
    ok 3 - clamps rng values to valid indices
      ---
      duration_ms: 0.207929
      type: 'test'
      ...
    1..3
ok 18 - selectRandomItem
  ---
  duration_ms: 3.017463
  type: 'test'
  ...
# Subtest: getScheduledHitTimeMs
    # Subtest: schedules within lead window
    ok 1 - schedules within lead window
      ---
      duration_ms: 0.907688
      type: 'test'
      ...
    # Subtest: fires immediately when outside lead window
    ok 2 - fires immediately when outside lead window
      ---
      duration_ms: 0.207823
      type: 'test'
      ...
    # Subtest: handles clock offsets between gig and audio time
    ok 3 - handles clock offsets between gig and audio time
      ---
      duration_ms: 0.176457
      type: 'test'
      ...
    1..3
ok 19 - getScheduledHitTimeMs
  ---
  duration_ms: 2.817726
  type: 'test'
  ...
# Subtest: CHARACTERS data integrity
ok 20 - CHARACTERS data integrity
  ---
  duration_ms: 1.524379
  type: 'test'
  ...
# Subtest: SONGS_DB data integrity
ok 21 - SONGS_DB data integrity
  ---
  duration_ms: 0.295062
  type: 'test'
  ...
# Subtest: SONGS_DB sourceOgg field
ok 22 - SONGS_DB sourceOgg field
  ---
  duration_ms: 0.492819
  type: 'test'
  ...
# Subtest: UPGRADES_DB data integrity
ok 23 - UPGRADES_DB data integrity
  ---
  duration_ms: 0.225889
  type: 'test'
  ...
# Subtest: ALL_VENUES data integrity
ok 24 - ALL_VENUES data integrity
  ---
  duration_ms: 0.39848
  type: 'test'
  ...
# Subtest: EVENTS_DB integrity
ok 25 - EVENTS_DB integrity
  ---
  duration_ms: 1.294581
  type: 'test'
  ...
# [Economy] Calculating Gig Financials { gig: undefined, score: 80, fame: 100 }
# [Economy] Gig Report Generated { net: 2314, income: 2937, expenses: 623 }
# [Economy] Calculating Gig Financials { gig: undefined, score: 80, fame: 10 }
# [Economy] Gig Report Generated { net: 1052, income: 1247, expenses: 195 }
# [Economy] Calculating Gig Financials { gig: undefined, score: 80, fame: 1000 }
# [Economy] Gig Report Generated { net: 1995, income: 2550, expenses: 555 }
# [Economy] Calculating Gig Financials { gig: undefined, score: 80, fame: 50 }
# [Economy] Gig Report Generated { net: 1743, income: 2167, expenses: 424 }
# [Economy] Calculating Gig Financials { gig: undefined, score: 80, fame: 50 }
# [Economy] Gig Report Generated { net: 2230, income: 2864, expenses: 634 }
# [Economy] Calculating Gig Financials { gig: undefined, score: 80, fame: 50 }
# [Economy] Gig Report Generated { net: 1314, income: 1569, expenses: 255 }
# [Economy] Calculating Gig Financials { gig: undefined, score: 40, fame: 100 }
# [Economy] Gig Report Generated { net: 2314, income: 2987, expenses: 673 }
# [Economy] Calculating Gig Financials { gig: undefined, score: 95, fame: 100 }
# [Economy] Gig Report Generated { net: 2719, income: 3662, expenses: 943 }
# [Economy] Calculating Gig Financials { gig: undefined, score: 95, fame: 100 }
# [Economy] Gig Report Generated { net: 2719, income: 3662, expenses: 943 }
# [Economy] Calculating Gig Financials { gig: undefined, score: 80, fame: 100 }
# [Economy] Gig Report Generated { net: 2434, income: 3187, expenses: 753 }
# [Economy] Calculating Gig Financials { gig: undefined, score: 80, fame: 100 }
# [Economy] Gig Report Generated { net: 1934, income: 2487, expenses: 553 }
# [Economy] Calculating Gig Financials { gig: undefined, score: 90, fame: 200 }
# [Economy] Gig Report Generated { net: 2703, income: 3267, expenses: 564 }
# [Economy] Calculating Gig Financials { gig: undefined, score: 100, fame: 200 }
# [Economy] Gig Report Generated { net: 2911, income: 3938, expenses: 1027 }
# [Economy] Calculating Gig Financials { gig: undefined, score: 80, fame: 100 }
# [Economy] Gig Report Generated { net: 2293, income: 2937, expenses: 644 }
# [Economy] Calculating Gig Financials { gig: undefined, score: 80, fame: 100 }
# [Economy] Gig Report Generated { net: 2314, income: 2937, expenses: 623 }
# [Economy] Calculating Gig Financials { gig: undefined, score: 80, fame: 100 }
# [Economy] Gig Report Generated { net: 2294, income: 2937, expenses: 643 }
# [Economy] Calculating Gig Financials { gig: undefined, score: 80, fame: 100 }
# [Economy] Gig Report Generated { net: 2434, income: 3187, expenses: 753 }
# [Economy] Calculating Gig Financials { gig: undefined, score: 80, fame: 100 }
# [Economy] Gig Report Generated { net: 655, income: 700, expenses: 45 }
# [Economy] Calculating Gig Financials { gig: undefined, score: 0, fame: 100 }
# [Economy] Gig Report Generated { net: 1984, income: 2387, expenses: 403 }
# [Economy] Calculating Gig Financials { gig: undefined, score: 100, fame: 100 }
# [Economy] Gig Report Generated { net: 2629, income: 3462, expenses: 833 }
# [Economy] Calculating Gig Financials { gig: undefined, score: 80, fame: 100 }
# [Economy] Gig Report Generated { net: 2314, income: 2937, expenses: 623 }
# [Economy] Calculating Gig Financials { gig: undefined, score: 80, fame: 100 }
# [Economy] Gig Report Generated { net: 2434, income: 3187, expenses: 753 }
# [Economy] Calculating Gig Financials { gig: undefined, score: 75, fame: 150 }
# [Economy] Gig Report Generated { net: 2380, income: 3025, expenses: 645 }
# [Economy] Calculating Gig Financials { gig: undefined, score: 85, fame: 5000 }
# [Economy] Gig Report Generated { net: 19430, income: 25075, expenses: 5645 }
# Subtest: calculateGigFinancials handles base case with ticket sales and guarantee
ok 26 - calculateGigFinancials handles base case with ticket sales and guarantee
  ---
  duration_ms: 3.607809
  type: 'test'
  ...
# Subtest: calculateGigFinancials applies fame scaling to fill rate
ok 27 - calculateGigFinancials applies fame scaling to fill rate
  ---
  duration_ms: 1.073067
  type: 'test'
  ...
# Subtest: calculateGigFinancials applies promo boost to fill rate
ok 28 - calculateGigFinancials applies promo boost to fill rate
  ---
  duration_ms: 1.351246
  type: 'test'
  ...
# Subtest: calculateGigFinancials applies price sensitivity penalty
ok 29 - calculateGigFinancials applies price sensitivity penalty
  ---
  duration_ms: 0.575496
  type: 'test'
  ...
# Subtest: calculateGigFinancials scales merch sales with performance
ok 30 - calculateGigFinancials scales merch sales with performance
  ---
  duration_ms: 0.615172
  type: 'test'
  ...
# Subtest: calculateGigFinancials applies S-rank merch bonus
ok 31 - calculateGigFinancials applies S-rank merch bonus
  ---
  duration_ms: 0.5857
  type: 'test'
  ...
# Subtest: calculateGigFinancials penalizes merch sales for misses
ok 32 - calculateGigFinancials penalizes merch sales for misses
  ---
  duration_ms: 0.798095
  type: 'test'
  ...
# Subtest: calculateGigFinancials handles sold out merch gracefully
ok 33 - calculateGigFinancials handles sold out merch gracefully
  ---
  duration_ms: 0.431179
  type: 'test'
  ...
# Subtest: calculateGigFinancials uses all inventory types for sales limit
ok 34 - calculateGigFinancials uses all inventory types for sales limit
  ---
  duration_ms: 0.547113
  type: 'test'
  ...
# Subtest: calculateGigFinancials includes transport costs based on distance
ok 35 - calculateGigFinancials includes transport costs based on distance
  ---
  duration_ms: 0.829996
  type: 'test'
  ...
# Subtest: calculateGigFinancials includes catering when enabled
ok 36 - calculateGigFinancials includes catering when enabled
  ---
  duration_ms: 0.493959
  type: 'test'
  ...
# Subtest: calculateGigFinancials supports new merch key
ok 37 - calculateGigFinancials supports new merch key
  ---
  duration_ms: 0.362431
  type: 'test'
  ...
# Subtest: calculateGigFinancials handles zero capacity venue
ok 38 - calculateGigFinancials handles zero capacity venue
  ---
  duration_ms: 0.404687
  type: 'test'
  ...
# Subtest: calculateGigFinancials handles extreme performance scores
ok 39 - calculateGigFinancials handles extreme performance scores
  ---
  duration_ms: 0.377669
  type: 'test'
  ...
# Subtest: calculateGigFinancials merch table modifier increases sales
ok 40 - calculateGigFinancials merch table modifier increases sales
  ---
  duration_ms: 1.094869
  type: 'test'
  ...
# Subtest: EXPENSE_CONSTANTS are properly defined
ok 41 - EXPENSE_CONSTANTS are properly defined
  ---
  duration_ms: 0.204526
  type: 'test'
  ...
# Subtest: calculateGigFinancials net profit matches income minus expenses
ok 42 - calculateGigFinancials net profit matches income minus expenses
  ---
  duration_ms: 0.324311
  type: 'test'
  ...
# Subtest: calculateGigFinancials handles high fame with high price
ok 43 - calculateGigFinancials handles high fame with high price
  ---
  duration_ms: 0.382372
  type: 'test'
  ...
# Subtest: calculateTravelExpenses returns correct cost structure
ok 44 - calculateTravelExpenses returns correct cost structure
  ---
  duration_ms: 0.329991
  type: 'test'
  ...
# [ErrorHandler] Test error {
#   name: 'StateError',
#   message: 'Test error',
#   category: 'state',
#   severity: 'high',
#   context: {},
#   recoverable: true,
#   timestamp: 1771166856307,
#   stack: 'StateError: Test error\\n' +
#     '    at TestContext.<anonymous> (file:///app/tests/errorHandler.test.js:76:19)\\n' +
#     '    at Test.runInAsyncScope (node:async_hooks:214:14)\\n' +
#     '    at Test.run (node:internal/test_runner/test:1047:25)\\n' +
#     '    at Test.start (node:internal/test_runner/test:944:17)\\n' +
#     '    at node:internal/test_runner/test:1440:71\\n' +
#     '    at node:internal/per_context/primordials:464:82\\n' +
#     '    at new Promise (<anonymous>)\\n' +
#     '    at new SafePromise (node:internal/per_context/primordials:433:3)\\n' +
#     '    at node:internal/per_context/primordials:464:9\\n' +
#     '    at Array.map (<anonymous>)'
# }
# [ErrorHandler] Test error {
#   name: 'StateError',
#   message: 'Test error',
#   category: 'state',
#   severity: 'high',
#   context: {},
#   recoverable: true,
#   timestamp: 1771166856311,
#   stack: 'StateError: Test error\\n' +
#     '    at TestContext.<anonymous> (file:///app/tests/errorHandler.test.js:90:19)\\n' +
#     '    at Test.runInAsyncScope (node:async_hooks:214:14)\\n' +
#     '    at Test.run (node:internal/test_runner/test:1047:25)\\n' +
#     '    at Suite.processPendingSubtests (node:internal/test_runner/test:744:18)\\n' +
#     '    at Test.postRun (node:internal/test_runner/test:1173:19)\\n' +
#     '    at Test.run (node:internal/test_runner/test:1101:12)\\n' +
#     '    at async Promise.all (index 0)\\n' +
#     '    at async Suite.run (node:internal/test_runner/test:1442:7)\\n' +
#     '    at async Test.processPendingSubtests (node:internal/test_runner/test:744:7)'
# }
# [ErrorHandler] Fallback {
#   name: 'Error',
#   message: 'Fallback',
#   category: 'unknown',
#   severity: 'medium',
#   context: {},
#   recoverable: true,
#   timestamp: 1771166856311,
#   stack: 'Error\\n' +
#     '    at TestContext.<anonymous> (file:///app/tests/errorHandler.test.js:97:19)\\n' +
#     '    at Test.runInAsyncScope (node:async_hooks:214:14)\\n' +
#     '    at Test.run (node:internal/test_runner/test:1047:25)\\n' +
#     '    at Suite.processPendingSubtests (node:internal/test_runner/test:744:18)\\n' +
#     '    at Test.postRun (node:internal/test_runner/test:1173:19)\\n' +
#     '    at Test.run (node:internal/test_runner/test:1101:12)\\n' +
#     '    at async Suite.processPendingSubtests (node:internal/test_runner/test:744:7)'
# }
# [ErrorHandler] Audio asset not found for "01 Kranker Schrank": looked up "01 Kranker Schrank.ogg" {
#   name: 'AudioError',
#   message: 'Audio asset not found for "01 Kranker Schrank": looked up "01 Kranker Schrank.ogg"',
#   category: 'audio',
#   severity: 'medium',
#   context: {
#     songName: '01 Kranker Schrank',
#     oggFilename: '01 Kranker Schrank.ogg'
#   },
#   recoverable: true,
#   timestamp: 1771166856312,
#   stack: 'AudioError: Audio asset not found for "01 Kranker Schrank": looked up "01 Kranker Schrank.ogg"\\n' +
#     '    at TestContext.<anonymous> (file:///app/tests/errorHandler.test.js:112:19)\\n' +
#     '    at Test.runInAsyncScope (node:async_hooks:214:14)\\n' +
#     '    at Test.run (node:internal/test_runner/test:1047:25)\\n' +
#     '    at Suite.processPendingSubtests (node:internal/test_runner/test:744:18)\\n' +
#     '    at Test.postRun (node:internal/test_runner/test:1173:19)\\n' +
#     '    at Test.run (node:internal/test_runner/test:1101:12)\\n' +
#     '    at async Suite.processPendingSubtests (node:internal/test_runner/test:744:7)'
# }
# [ErrorHandler] Storage operation failed: test {
#   name: 'StorageError',
#   message: 'Storage operation failed: test',
#   category: 'storage',
#   severity: 'medium',
#   context: { originalError: 'Storage error' },
#   recoverable: true,
#   timestamp: 1771166856313,
#   stack: 'StorageError: Storage operation failed: test\\n' +
#     '    at safeStorageOperation (file:///app/src/utils/errorHandler.js:219:7)\\n' +
#     '    at TestContext.<anonymous> (file:///app/tests/errorHandler.test.js:135:20)\\n' +
#     '    at Test.runInAsyncScope (node:async_hooks:214:14)\\n' +
#     '    at Test.run (node:internal/test_runner/test:1047:25)\\n' +
#     '    at Suite.processPendingSubtests (node:internal/test_runner/test:744:18)\\n' +
#     '    at Test.postRun (node:internal/test_runner/test:1173:19)\\n' +
#     '    at Test.run (node:internal/test_runner/test:1101:12)\\n' +
#     '    at async Promise.all (index 0)\\n' +
#     '    at async Suite.run (node:internal/test_runner/test:1442:7)\\n' +
#     '    at async Test.processPendingSubtests (node:internal/test_runner/test:744:7)'
# }
# Subtest: Custom Error Classes
    # Subtest: StateError
        # Subtest: should have correct name
        ok 1 - should have correct name
          ---
          duration_ms: 1.08058
          type: 'test'
          ...
        1..1
    ok 1 - StateError
      ---
      duration_ms: 2.050801
      type: 'suite'
      ...
    # Subtest: StorageError
        # Subtest: should have correct name
        ok 1 - should have correct name
          ---
          duration_ms: 0.318738
          type: 'test'
          ...
        1..1
    ok 2 - StorageError
      ---
      duration_ms: 0.450049
      type: 'suite'
      ...
    # Subtest: AudioError
        # Subtest: should have correct name and category
        ok 1 - should have correct name and category
          ---
          duration_ms: 0.346365
          type: 'test'
          ...
        # Subtest: should store context for missing OGG asset diagnostics
        ok 2 - should store context for missing OGG asset diagnostics
          ---
          duration_ms: 0.34077
          type: 'test'
          ...
        # Subtest: should produce a complete log object via toLogObject
        ok 3 - should produce a complete log object via toLogObject
          ---
          duration_ms: 0.873481
          type: 'test'
          ...
        1..3
    ok 3 - AudioError
      ---
      duration_ms: 1.998559
      type: 'suite'
      ...
    1..3
ok 45 - Custom Error Classes
  ---
  duration_ms: 5.340172
  type: 'suite'
  ...
# Subtest: handleError
    # Subtest: should call addToast when not silent
    ok 1 - should call addToast when not silent
      ---
      duration_ms: 3.118055
      type: 'test'
      ...
    # Subtest: should not call addToast when silent
    ok 2 - should not call addToast when silent
      ---
      duration_ms: 0.629398
      type: 'test'
      ...
    # Subtest: should use fallback message for errors without message
    ok 3 - should use fallback message for errors without message
      ---
      duration_ms: 0.547759
      type: 'test'
      ...
    # Subtest: should handle AudioError with silent mode and preserve context
    ok 4 - should handle AudioError with silent mode and preserve context
      ---
      duration_ms: 0.672323
      type: 'test'
      ...
    1..4
ok 46 - handleError
  ---
  duration_ms: 5.590313
  type: 'suite'
  ...
# Subtest: safeStorageOperation
    # Subtest: should return result on success
    ok 1 - should return result on success
      ---
      duration_ms: 0.333887
      type: 'test'
      ...
    # Subtest: should return fallback on error
    ok 2 - should return fallback on error
      ---
      duration_ms: 0.898861
      type: 'test'
      ...
    1..2
ok 47 - safeStorageOperation
  ---
  duration_ms: 1.397148
  type: 'suite'
  ...
# (node:5170) ExperimentalWarning: Module mocking is an experimental feature and might change at any time
# (Use `node --trace-warnings ...` to show where the warning was created)
# [EventEngine] Event Selected event_normal
# Subtest: eventEngine.filterEvents filters by trigger
ok 48 - eventEngine.filterEvents filters by trigger
  ---
  duration_ms: 2.096588
  type: 'test'
  ...
# Subtest: eventEngine.filterEvents respects conditions
ok 49 - eventEngine.filterEvents respects conditions
  ---
  duration_ms: 0.284561
  type: 'test'
  ...
# Subtest: eventEngine.selectEvent respects cooldowns
ok 50 - eventEngine.selectEvent respects cooldowns
  ---
  duration_ms: 1.621426
  type: 'test'
  ...
# Subtest: eventEngine.selectEvent prioritizes pending events
ok 51 - eventEngine.selectEvent prioritizes pending events
  ---
  duration_ms: 0.209823
  type: 'test'
  ...
# Subtest: eventEngine.resolveChoice handles simple effects
ok 52 - eventEngine.resolveChoice handles simple effects
  ---
  duration_ms: 0.460939
  type: 'test'
  ...
# Subtest: eventEngine.resolveChoice handles skill checks (success)
ok 53 - eventEngine.resolveChoice handles skill checks (success)
  ---
  duration_ms: 0.354839
  type: 'test'
  ...
# Subtest: eventEngine.resolveChoice handles skill checks (failure)
ok 54 - eventEngine.resolveChoice handles skill checks (failure)
  ---
  duration_ms: 0.360844
  type: 'test'
  ...
# Subtest: eventEngine.resolveChoice handles luck checks
ok 55 - eventEngine.resolveChoice handles luck checks
  ---
  duration_ms: 0.253199
  type: 'test'
  ...
# Subtest: eventEngine.resolveChoice sets nextEventId
ok 56 - eventEngine.resolveChoice sets nextEventId
  ---
  duration_ms: 0.402895
  type: 'test'
  ...
# Subtest: eventEngine.processOptions returns event when no processing needed
ok 57 - eventEngine.processOptions returns event when no processing needed
  ---
  duration_ms: 0.582927
  type: 'test'
  ...
# Subtest: eventEngine.processOptions handles van_breakdown with spare_tire
ok 58 - eventEngine.processOptions handles van_breakdown with spare_tire
  ---
  duration_ms: 0.305589
  type: 'test'
  ...
# Subtest: eventEngine.processOptions does not add spare tire option without inventory
ok 59 - eventEngine.processOptions does not add spare tire option without inventory
  ---
  duration_ms: 0.190582
  type: 'test'
  ...
# Subtest: eventEngine.applyResult handles resource effects
ok 60 - eventEngine.applyResult handles resource effects
  ---
  duration_ms: 0.313409
  type: 'test'
  ...
# Subtest: eventEngine.applyResult handles stat effects
ok 61 - eventEngine.applyResult handles stat effects
  ---
  duration_ms: 0.138392
  type: 'test'
  ...
# Subtest: eventEngine.applyResult handles harmony stat
ok 62 - eventEngine.applyResult handles harmony stat
  ---
  duration_ms: 0.20079
  type: 'test'
  ...
# Subtest: eventEngine.applyResult handles mood changes
ok 63 - eventEngine.applyResult handles mood changes
  ---
  duration_ms: 0.170088
  type: 'test'
  ...
# Subtest: eventEngine.applyResult handles stamina changes
ok 64 - eventEngine.applyResult handles stamina changes
  ---
  duration_ms: 0.191873
  type: 'test'
  ...
# Subtest: eventEngine.applyResult handles combined mood and stamina in composite
ok 65 - eventEngine.applyResult handles combined mood and stamina in composite
  ---
  duration_ms: 0.1627
  type: 'test'
  ...
# Subtest: eventEngine.applyResult handles van fuel
ok 66 - eventEngine.applyResult handles van fuel
  ---
  duration_ms: 0.131856
  type: 'test'
  ...
# Subtest: eventEngine.applyResult handles van condition stat
ok 67 - eventEngine.applyResult handles van condition stat
  ---
  duration_ms: 0.271758
  type: 'test'
  ...
# Subtest: eventEngine.applyResult handles game over flag
ok 68 - eventEngine.applyResult handles game over flag
  ---
  duration_ms: 0.150078
  type: 'test'
  ...
# Subtest: eventEngine.applyResult handles story flags
ok 69 - eventEngine.applyResult handles story flags
  ---
  duration_ms: 0.141199
  type: 'test'
  ...
# Subtest: eventEngine.applyResult handles chain events
ok 70 - eventEngine.applyResult handles chain events
  ---
  duration_ms: 0.133978
  type: 'test'
  ...
# Subtest: eventEngine.applyResult handles composite effects
ok 71 - eventEngine.applyResult handles composite effects
  ---
  duration_ms: 0.284025
  type: 'test'
  ...
# Subtest: eventEngine.applyResult returns null for null result
ok 72 - eventEngine.applyResult returns null for null result
  ---
  duration_ms: 0.122303
  type: 'test'
  ...
# Subtest: eventEngine.applyResult handles unlock effects
ok 73 - eventEngine.applyResult handles unlock effects
  ---
  duration_ms: 0.13205
  type: 'test'
  ...
# Subtest: eventEngine.applyResult preserves nextEventId from result
ok 74 - eventEngine.applyResult preserves nextEventId from result
  ---
  duration_ms: 0.143953
  type: 'test'
  ...
# Subtest: eventEngine.applyResult handles time stat
ok 75 - eventEngine.applyResult handles time stat
  ---
  duration_ms: 0.127035
  type: 'test'
  ...
# Subtest: eventEngine.applyResult handles viral stat
ok 76 - eventEngine.applyResult handles viral stat
  ---
  duration_ms: 0.123167
  type: 'test'
  ...
# Subtest: eventEngine.applyResult handles inventory numeric increment
ok 77 - eventEngine.applyResult handles inventory numeric increment
  ---
  duration_ms: 0.183589
  type: 'test'
  ...
# Subtest: eventEngine.applyResult handles inventory non-numeric value
ok 78 - eventEngine.applyResult handles inventory non-numeric value
  ---
  duration_ms: 0.14458
  type: 'test'
  ...
# Subtest: eventEngine.applyResult accumulates inventory values across composite effects
ok 79 - eventEngine.applyResult accumulates inventory values across composite effects
  ---
  duration_ms: 0.146555
  type: 'test'
  ...
# Subtest: eventEngine logic allows negative inventory in delta
ok 80 - eventEngine logic allows negative inventory in delta
  ---
  duration_ms: 0.130532
  type: 'test'
  ...
# Subtest: eventEngine.applyResult handles hype stat as fame
ok 81 - eventEngine.applyResult handles hype stat as fame
  ---
  duration_ms: 0.118082
  type: 'test'
  ...
# Subtest: eventEngine.applyResult handles crowd_energy stat as fame
ok 82 - eventEngine.applyResult handles crowd_energy stat as fame
  ---
  duration_ms: 2.563162
  type: 'test'
  ...
# Subtest: eventEngine.applyResult handles score stat increment
ok 83 - eventEngine.applyResult handles score stat increment
  ---
  duration_ms: 0.176202
  type: 'test'
  ...
# Subtest: eventEngine.applyResult accumulates fame from mixed stats (fame, hype, crowd_energy)
ok 84 - eventEngine.applyResult accumulates fame from mixed stats (fame, hype, crowd_energy)
  ---
  duration_ms: 0.136235
  type: 'test'
  ...
# Subtest: resolveEventChoice returns delta for direct effects
ok 85 - resolveEventChoice returns delta for direct effects
  ---
  duration_ms: 1.747012
  type: 'test'
  ...
# Subtest: resolveEventChoice handles missing choices safely
ok 86 - resolveEventChoice handles missing choices safely
  ---
  duration_ms: 0.192058
  type: 'test'
  ...
# [Economy] Calculating Gig Financials { gig: undefined, score: 30, fame: 100 }
# [Economy] Gig Report Generated { net: 1784, income: 2237, expenses: 453 }
# [Economy] Calculating Gig Financials { gig: undefined, score: 95, fame: 100 }
# [Economy] Gig Report Generated { net: 2869, income: 3812, expenses: 943 }
# [Economy] Calculating Gig Financials { gig: undefined, score: 70, fame: 100 }
# [Economy] Gig Report Generated { net: 2284, income: 2887, expenses: 603 }
# [Economy] Calculating Gig Financials { gig: undefined, score: 70, fame: 100 }
# [Economy] Gig Report Generated { net: 2404, income: 3137, expenses: 733 }
# [GameState] Update Player { money: -100 }
# [GameState] Update Band { harmony: -50 }
# [GameState] Update Band { harmony: 200 }
# [GameState] Day Advanced to 2
# Subtest: calculateDailyUpdates: daily cost includes band size scaling
ok 87 - calculateDailyUpdates: daily cost includes band size scaling
  ---
  duration_ms: 1.748345
  type: 'test'
  ...
# Subtest: calculateDailyUpdates: money never goes negative
ok 88 - calculateDailyUpdates: money never goes negative
  ---
  duration_ms: 0.408863
  type: 'test'
  ...
# Subtest: calculateDailyUpdates: van condition decays daily
ok 89 - calculateDailyUpdates: van condition decays daily
  ---
  duration_ms: 0.207338
  type: 'test'
  ...
# Subtest: calculateDailyUpdates: van breakdown chance increases when condition is low
ok 90 - calculateDailyUpdates: van breakdown chance increases when condition is low
  ---
  duration_ms: 0.196049
  type: 'test'
  ...
# Subtest: calculateDailyUpdates: van condition does not go below 0
ok 91 - calculateDailyUpdates: van condition does not go below 0
  ---
  duration_ms: 0.32235
  type: 'test'
  ...
# Subtest: calculateDailyUpdates: harmony is clamped to [1, 100]
ok 92 - calculateDailyUpdates: harmony is clamped to [1, 100]
  ---
  duration_ms: 0.225951
  type: 'test'
  ...
# Subtest: calculateDailyUpdates: harmony clamped even with regen active
ok 93 - calculateDailyUpdates: harmony clamped even with regen active
  ---
  duration_ms: 0.205163
  type: 'test'
  ...
# Subtest: calculateGigFinancials: low performance penalizes merch
ok 94 - calculateGigFinancials: low performance penalizes merch
  ---
  duration_ms: 2.749455
  type: 'test'
  ...
# Subtest: calculateGigFinancials: merch table modifier increases merch revenue
ok 95 - calculateGigFinancials: merch table modifier increases merch revenue
  ---
  duration_ms: 1.351476
  type: 'test'
  ...
# Subtest: gameReducer: UPDATE_PLAYER clamps money to 0
ok 96 - gameReducer: UPDATE_PLAYER clamps money to 0
  ---
  duration_ms: 1.263668
  type: 'test'
  ...
# Subtest: gameReducer: UPDATE_BAND clamps harmony to [1, 100]
ok 97 - gameReducer: UPDATE_BAND clamps harmony to [1, 100]
  ---
  duration_ms: 0.550944
  type: 'test'
  ...
# Subtest: gameReducer: ADVANCE_DAY clamps harmony
ok 98 - gameReducer: ADVANCE_DAY clamps harmony
  ---
  duration_ms: 0.343267
  type: 'test'
  ...
# Subtest: applyEventDelta: fuel clamped to [0, 100]
ok 99 - applyEventDelta: fuel clamped to [0, 100]
  ---
  duration_ms: 0.551026
  type: 'test'
  ...
# Subtest: applyEventDelta: harmony clamped to [1, 100]
ok 100 - applyEventDelta: harmony clamped to [1, 100]
  ---
  duration_ms: 0.180453
  type: 'test'
  ...
# Subtest: applyEventDelta: money clamped to 0
ok 101 - applyEventDelta: money clamped to 0
  ---
  duration_ms: 0.174824
  type: 'test'
  ...
# [GameState] Scene Change: INTRO -> OVERWORLD
# [GameState] Scene Change: INTRO -> OVERWORLD
# [GameState] Update Player { money: 1000 }
# [GameState] Update Player { fame: 50 }
# [GameState] Update Player { money: 1000 }
# [GameState] Update Band { harmony: 50 }
# [GameState] Update Band { harmony: -20 }
# [GameState] Update Band { harmony: 0 }
# [GameState] Update Band { members: [ { name: 'Test', mood: 100, stamina: 100 } ] }
# [GameState] Day Advanced to 2
# [GameState] State Reset (Debug)
# [GameState] Game Loaded
# [GameState] Game Loaded
# [GameState] Game Loaded
# Subtest: gameReducer
    # Subtest: CHANGE_SCENE
        # Subtest: should change the current scene
        ok 1 - should change the current scene
          ---
          duration_ms: 3.143866
          type: 'test'
          ...
        # Subtest: should preserve other state properties
        ok 2 - should preserve other state properties
          ---
          duration_ms: 0.478385
          type: 'test'
          ...
        1..2
    ok 1 - CHANGE_SCENE
      ---
      duration_ms: 4.547382
      type: 'suite'
      ...
    # Subtest: UPDATE_PLAYER
        # Subtest: should update player money
        ok 1 - should update player money
          ---
          duration_ms: 0.763129
          type: 'test'
          ...
        # Subtest: should update player fame
        ok 2 - should update player fame
          ---
          duration_ms: 0.609163
          type: 'test'
          ...
        # Subtest: should merge player updates with existing state
        ok 3 - should merge player updates with existing state
          ---
          duration_ms: 0.61648
          type: 'test'
          ...
        1..3
    ok 2 - UPDATE_PLAYER
      ---
      duration_ms: 2.285593
      type: 'suite'
      ...
    # Subtest: UPDATE_BAND
        # Subtest: should update band harmony
        ok 1 - should update band harmony
          ---
          duration_ms: 1.943433
          type: 'test'
          ...
        # Subtest: should clamp band harmony above zero
        ok 2 - should clamp band harmony above zero
          ---
          duration_ms: 0.632878
          type: 'test'
          ...
        # Subtest: should clamp band harmony of zero to one
        ok 3 - should clamp band harmony of zero to one
          ---
          duration_ms: 0.574394
          type: 'test'
          ...
        # Subtest: should update band members
        ok 4 - should update band members
          ---
          duration_ms: 1.28823
          type: 'test'
          ...
        1..4
    ok 3 - UPDATE_BAND
      ---
      duration_ms: 4.804898
      type: 'suite'
      ...
    # Subtest: ADVANCE_DAY
        # Subtest: should clamp harmony after daily updates
        ok 1 - should clamp harmony after daily updates
          ---
          duration_ms: 0.746846
          type: 'test'
          ...
        1..1
    ok 4 - ADVANCE_DAY
      ---
      duration_ms: 0.871355
      type: 'suite'
      ...
    # Subtest: UPDATE_SOCIAL
        # Subtest: should update social media followers
        ok 1 - should update social media followers
          ---
          duration_ms: 0.346514
          type: 'test'
          ...
        # Subtest: should preserve other social stats
        ok 2 - should preserve other social stats
          ---
          duration_ms: 0.230892
          type: 'test'
          ...
        1..2
    ok 5 - UPDATE_SOCIAL
      ---
      duration_ms: 0.787742
      type: 'suite'
      ...
    # Subtest: SET_GIG_MODIFIERS
        # Subtest: should update gig modifiers with object payload
        ok 1 - should update gig modifiers with object payload
          ---
          duration_ms: 0.303706
          type: 'test'
          ...
        # Subtest: should update gig modifiers with function payload
        ok 2 - should update gig modifiers with function payload
          ---
          duration_ms: 0.268228
          type: 'test'
          ...
        1..2
    ok 6 - SET_GIG_MODIFIERS
      ---
      duration_ms: 0.719308
      type: 'suite'
      ...
    # Subtest: ADD_TOAST
        # Subtest: should add toast to array
        ok 1 - should add toast to array
          ---
          duration_ms: 0.256484
          type: 'test'
          ...
        1..1
    ok 7 - ADD_TOAST
      ---
      duration_ms: 0.353723
      type: 'suite'
      ...
    # Subtest: REMOVE_TOAST
        # Subtest: should remove toast by id
        ok 1 - should remove toast by id
          ---
          duration_ms: 1.724923
          type: 'test'
          ...
        1..1
    ok 8 - REMOVE_TOAST
      ---
      duration_ms: 1.821158
      type: 'suite'
      ...
    # Subtest: CONSUME_ITEM
        # Subtest: should decrement numeric inventory item
        ok 1 - should decrement numeric inventory item
          ---
          duration_ms: 0.45356
          type: 'test'
          ...
        # Subtest: should set boolean inventory item to false
        ok 2 - should set boolean inventory item to false
          ---
          duration_ms: 0.270503
          type: 'test'
          ...
        # Subtest: should not go below zero
        ok 3 - should not go below zero
          ---
          duration_ms: 0.178628
          type: 'test'
          ...
        1..3
    ok 9 - CONSUME_ITEM
      ---
      duration_ms: 1.059325
      type: 'suite'
      ...
    # Subtest: RESET_STATE
        # Subtest: should reset to initial state
        ok 1 - should reset to initial state
          ---
          duration_ms: 0.73545
          type: 'test'
          ...
        1..1
    ok 10 - RESET_STATE
      ---
      duration_ms: 0.840136
      type: 'suite'
      ...
    # Subtest: LOAD_GAME
        # Subtest: should load saved state
        ok 1 - should load saved state
          ---
          duration_ms: 0.757927
          type: 'test'
          ...
        # Subtest: should migrate energy to catering in gigModifiers
        ok 2 - should migrate energy to catering in gigModifiers
          ---
          duration_ms: 0.305433
          type: 'test'
          ...
        # Subtest: should merge with default values for missing properties
        ok 3 - should merge with default values for missing properties
          ---
          duration_ms: 0.400232
          type: 'test'
          ...
        1..3
    ok 11 - LOAD_GAME
      ---
      duration_ms: 1.658402
      type: 'suite'
      ...
    # Subtest: unknown action
        # Subtest: should return current state for unknown action
        ok 1 - should return current state for unknown action
          ---
          duration_ms: 0.528963
          type: 'test'
          ...
        1..1
    ok 12 - unknown action
      ---
      duration_ms: 0.614711
      type: 'suite'
      ...
    1..12
ok 102 - gameReducer
  ---
  duration_ms: 22.024187
  type: 'suite'
  ...
# Subtest: ActionTypes
    # Subtest: should have all expected action types
    ok 1 - should have all expected action types
      ---
      duration_ms: 0.232457
      type: 'test'
      ...
    1..1
ok 103 - ActionTypes
  ---
  duration_ms: 0.316737
  type: 'suite'
  ...
# Subtest: applyEventDelta clamps player and band values
ok 104 - applyEventDelta clamps player and band values
  ---
  duration_ms: 1.42614
  type: 'test'
  ...
# Subtest: applyEventDelta updates social channels safely
ok 105 - applyEventDelta updates social channels safely
  ---
  duration_ms: 0.283785
  type: 'test'
  ...
# Subtest: applyEventDelta applies player updates
ok 106 - applyEventDelta applies player updates
  ---
  duration_ms: 1.44392
  type: 'test'
  ...
# Subtest: applyEventDelta clamps values
ok 107 - applyEventDelta clamps values
  ---
  duration_ms: 0.293637
  type: 'test'
  ...
# Subtest: applyEventDelta handles band inventory updates
ok 108 - applyEventDelta handles band inventory updates
  ---
  duration_ms: 0.257822
  type: 'test'
  ...
# Subtest: applyEventDelta applies per-member deltas
ok 109 - applyEventDelta applies per-member deltas
  ---
  duration_ms: 0.309292
  type: 'test'
  ...
# Subtest: applyEventDelta handles social updates
ok 110 - applyEventDelta handles social updates
  ---
  duration_ms: 0.250633
  type: 'test'
  ...
# Subtest: applyEventDelta handles flags
ok 111 - applyEventDelta handles flags
  ---
  duration_ms: 0.353965
  type: 'test'
  ...
# Subtest: updateGigPerformanceStats tracks peak combo and hype
ok 112 - updateGigPerformanceStats tracks peak combo and hype
  ---
  duration_ms: 1.25277
  type: 'test'
  ...
# Subtest: buildGigStatsSnapshot includes required economy fields
ok 113 - buildGigStatsSnapshot includes required economy fields
  ---
  duration_ms: 0.977326
  type: 'test'
  ...
# [GameState] Scene Change: INTRO -> MENU
# [GameState] State Reset (Debug)
# [GameState] Scene Change: INTRO -> OVERWORLD
# [GameState] Map Generated
# [GameState] Update Player {
#   money: 470,
#   currentNodeId: 'node_1_0',
#   location: 'Test City',
#   van: { fuel: 85, condition: 100, upgrades: [], breakdownChance: 0.05 }
# }
# [GameState] Day Advanced to 2
# [GameState] Starting Gig Sequence Test Punk Keller
# [GameState] Scene Change: PREGIG -> GIG
# [GameState] Scene Change: GIG -> POSTGIG
# [Economy] Calculating Gig Financials { gig: 'Test Punk Keller', score: 30, fame: 0 }
# [Economy] Gig Report Generated { net: 1226, income: 1460, expenses: 234 }
# [GameState] Update Player { money: 680, fame: 100 }
# [GameState] Set Current Gig
# [GameState] Scene Change: POSTGIG -> OVERWORLD
# [GameState] Update Player { money: 660, currentNodeId: 'node_1_0' }
# [GameState] Day Advanced to 3
# [GameState] Starting Gig Sequence Test Punk Keller
# [GameState] Scene Change: INTRO -> OVERWORLD
# [GameState] Update Player { money: 5 }
# [GameState] Starting Gig Sequence Test Punk Keller
# [GameState] Scene Change: PREGIG -> GIG
# [GameState] Scene Change: GIG -> POSTGIG
# [GameState] Update Player { money: -95 }
# [GameState] Scene Change: POSTGIG -> GAMEOVER
# [GameState] State Reset (Debug)
# [GameState] Scene Change: INTRO -> MENU
# [GameState] Update Player { money: -999 }
# [GameState] Applying Event Delta { player: { money: -99999 } }
# [GameState] Update Band { harmony: -50 }
# [GameState] Update Band { harmony: 200 }
# [GameState] Applying Event Delta { band: { harmony: -200 } }
# [GameState] Applying Event Delta { player: { van: { fuel: 500 } } }
# [GameState] Applying Event Delta { player: { van: { fuel: -500 } } }
# [GameState] Applying Event Delta { player: { van: { condition: -500 } } }
# [GameState] Update Player { money: 50 }
# [GameState] Day Advanced to 2
# [GameState] Day Advanced to 3
# [GameState] Day Advanced to 4
# [GameState] Day Advanced to 5
# [GameState] Day Advanced to 6
# [GameState] Day Advanced to 2
# [GameState] Update Band {
#   inventory: {
#     shirts: 0,
#     hoodies: 20,
#     patches: 100,
#     cds: 30,
#     vinyl: 10,
#     strings: true,
#     cables: true,
#     drum_parts: true,
#     golden_pick: false
#   }
# }
# [GameState] Game Loaded
# [GameState] Game Loaded
# [GameState] Game Loaded
# [GameState] Game Loaded
# [GameState] Game Loaded
# [GameState] Game Loaded
# [GameState] Scene Change: INTRO -> INTRO
# [GameState] Scene Change: INTRO -> MENU
# [GameState] Scene Change: INTRO -> MENU
# [GameState] Scene Change: MENU -> OVERWORLD
# [GameState] Scene Change: INTRO -> MENU
# [GameState] Scene Change: MENU -> SETTINGS
# [GameState] Scene Change: INTRO -> MENU
# [GameState] Scene Change: MENU -> CREDITS
# [GameState] Scene Change: INTRO -> OVERWORLD
# [GameState] Scene Change: OVERWORLD -> PREGIG
# [GameState] Scene Change: INTRO -> OVERWORLD
# [GameState] Scene Change: OVERWORLD -> GAMEOVER
# [GameState] Scene Change: INTRO -> OVERWORLD
# [GameState] Scene Change: OVERWORLD -> MENU
# [GameState] Scene Change: INTRO -> PREGIG
# [GameState] Scene Change: PREGIG -> GIG
# [GameState] Scene Change: INTRO -> PREGIG
# [GameState] Scene Change: PREGIG -> OVERWORLD
# [GameState] Scene Change: INTRO -> GIG
# [GameState] Scene Change: GIG -> POSTGIG
# [GameState] Scene Change: INTRO -> GIG
# [GameState] Scene Change: GIG -> OVERWORLD
# [GameState] Scene Change: INTRO -> POSTGIG
# [GameState] Scene Change: POSTGIG -> OVERWORLD
# [GameState] Scene Change: INTRO -> POSTGIG
# [GameState] Scene Change: POSTGIG -> GAMEOVER
# [GameState] Scene Change: INTRO -> GAMEOVER
# [GameState] Scene Change: GAMEOVER -> MENU
# [GameState] Scene Change: INTRO -> SETTINGS
# [GameState] Scene Change: SETTINGS -> MENU
# [GameState] Scene Change: INTRO -> CREDITS
# [GameState] Scene Change: CREDITS -> MENU
# [GameState] Scene Change: INTRO -> OVERWORLD
# [GameState] Starting Gig Sequence Test Punk Keller
# [GameState] Day Advanced to 2
# [GameState] Day Advanced to 2
# Subtest: Golden Path: Full Tour Cycle
    # Subtest: Phase 0: Initial state is INTRO
    ok 1 - Phase 0: Initial state is INTRO
      ---
      duration_ms: 1.101871
      type: 'test'
      ...
    # Subtest: Phase 1: INTRO  MENU
    ok 2 - Phase 1: INTRO  MENU
      ---
      duration_ms: 1.664468
      type: 'test'
      ...
    # Subtest: Phase 2: MENU  OVERWORLD via RESET_STATE + CHANGE_SCENE
    ok 3 - Phase 2: MENU  OVERWORLD via RESET_STATE + CHANGE_SCENE
      ---
      duration_ms: 0.435516
      type: 'test'
      ...
    # Subtest: Phase 3: Set up map in OVERWORLD
    ok 4 - Phase 3: Set up map in OVERWORLD
      ---
      duration_ms: 0.478979
      type: 'test'
      ...
    # Subtest: Phase 4: Travel costs (simulate OVERWORLD travel)
    ok 5 - Phase 4: Travel costs (simulate OVERWORLD travel)
      ---
      duration_ms: 1.163988
      type: 'test'
      ...
    # Subtest: Phase 5: ADVANCE_DAY after travel
    ok 6 - Phase 5: ADVANCE_DAY after travel
      ---
      duration_ms: 0.555722
      type: 'test'
      ...
    # Subtest: Phase 6: OVERWORLD  PREGIG via START_GIG
    ok 7 - Phase 6: OVERWORLD  PREGIG via START_GIG
      ---
      duration_ms: 0.665169
      type: 'test'
      ...
    # Subtest: Phase 7: Configure setlist and modifiers in PREGIG
    ok 8 - Phase 7: Configure setlist and modifiers in PREGIG
      ---
      duration_ms: 0.362059
      type: 'test'
      ...
    # Subtest: Phase 8: PREGIG  GIG
    ok 9 - Phase 8: PREGIG  GIG
      ---
      duration_ms: 0.426447
      type: 'test'
      ...
    # Subtest: Phase 9: Gig performance produces stats
    ok 10 - Phase 9: Gig performance produces stats
      ---
      duration_ms: 0.310925
      type: 'test'
      ...
    # Subtest: Phase 10: GIG  POSTGIG
    ok 11 - Phase 10: GIG  POSTGIG
      ---
      duration_ms: 0.645591
      type: 'test'
      ...
    # Subtest: Phase 11: Calculate financials in POSTGIG
    ok 12 - Phase 11: Calculate financials in POSTGIG
      ---
      duration_ms: 1.337352
      type: 'test'
      ...
    # Subtest: Phase 12: Apply earnings and return to OVERWORLD
    ok 13 - Phase 12: Apply earnings and return to OVERWORLD
      ---
      duration_ms: 0.570437
      type: 'test'
      ...
    # Subtest: Phase 13: Second gig cycle preserves progression
    ok 14 - Phase 13: Second gig cycle preserves progression
      ---
      duration_ms: 0.423827
      type: 'test'
      ...
    1..14
ok 114 - Golden Path: Full Tour Cycle
  ---
  duration_ms: 13.35683
  type: 'test'
  ...
# Subtest: Golden Path: Bankruptcy triggers GAMEOVER
    # Subtest: Drain money to near zero
    ok 1 - Drain money to near zero
      ---
      duration_ms: 0.322072
      type: 'test'
      ...
    # Subtest: Start a gig
    ok 2 - Start a gig
      ---
      duration_ms: 0.800939
      type: 'test'
      ...
    # Subtest: Negative net triggers GAMEOVER path
    ok 3 - Negative net triggers GAMEOVER path
      ---
      duration_ms: 0.940091
      type: 'test'
      ...
    # Subtest: GAMEOVER  MENU via RESET_STATE
    ok 4 - GAMEOVER  MENU via RESET_STATE
      ---
      duration_ms: 0.294002
      type: 'test'
      ...
    1..4
ok 115 - Golden Path: Bankruptcy triggers GAMEOVER
  ---
  duration_ms: 3.042251
  type: 'test'
  ...
# Subtest: Golden Path: State safety invariants across transitions
    # Subtest: Money never goes negative from UPDATE_PLAYER
    ok 1 - Money never goes negative from UPDATE_PLAYER
      ---
      duration_ms: 0.313604
      type: 'test'
      ...
    # Subtest: Money never goes negative from APPLY_EVENT_DELTA
    ok 2 - Money never goes negative from APPLY_EVENT_DELTA
      ---
      duration_ms: 0.656619
      type: 'test'
      ...
    # Subtest: Harmony clamped [1, 100] from UPDATE_BAND
    ok 3 - Harmony clamped [1, 100] from UPDATE_BAND
      ---
      duration_ms: 1.043355
      type: 'test'
      ...
    # Subtest: Harmony clamped [1, 100] from APPLY_EVENT_DELTA
    ok 4 - Harmony clamped [1, 100] from APPLY_EVENT_DELTA
      ---
      duration_ms: 0.517569
      type: 'test'
      ...
    # Subtest: Fuel clamped [0, 100] from APPLY_EVENT_DELTA
    ok 5 - Fuel clamped [0, 100] from APPLY_EVENT_DELTA
      ---
      duration_ms: 0.877351
      type: 'test'
      ...
    # Subtest: Van condition clamped [0, 100] from APPLY_EVENT_DELTA
    ok 6 - Van condition clamped [0, 100] from APPLY_EVENT_DELTA
      ---
      duration_ms: 0.540141
      type: 'test'
      ...
    # Subtest: ADVANCE_DAY preserves state safety after many days
    ok 7 - ADVANCE_DAY preserves state safety after many days
      ---
      duration_ms: 1.582675
      type: 'test'
      ...
    # Subtest: Van condition decays daily and breakdown chance adjusts
    ok 8 - Van condition decays daily and breakdown chance adjusts
      ---
      duration_ms: 0.452548
      type: 'test'
      ...
    # Subtest: CONSUME_ITEM decrements numeric inventory
    ok 9 - CONSUME_ITEM decrements numeric inventory
      ---
      duration_ms: 0.208649
      type: 'test'
      ...
    # Subtest: CONSUME_ITEM sets boolean inventory to false
    ok 10 - CONSUME_ITEM sets boolean inventory to false
      ---
      duration_ms: 0.162731
      type: 'test'
      ...
    # Subtest: CONSUME_ITEM never goes below 0
    ok 11 - CONSUME_ITEM never goes below 0
      ---
      duration_ms: 0.319849
      type: 'test'
      ...
    1..11
ok 116 - Golden Path: State safety invariants across transitions
  ---
  duration_ms: 7.936109
  type: 'test'
  ...
# Subtest: Golden Path: SET_GIG_MODIFIERS functional updater
    # Subtest: Object payload merges with existing modifiers
    ok 1 - Object payload merges with existing modifiers
      ---
      duration_ms: 0.195912
      type: 'test'
      ...
    # Subtest: Function payload receives current modifiers
    ok 2 - Function payload receives current modifiers
      ---
      duration_ms: 0.17283
      type: 'test'
      ...
    1..2
ok 117 - Golden Path: SET_GIG_MODIFIERS functional updater
  ---
  duration_ms: 3.619857
  type: 'test'
  ...
# Subtest: Golden Path: LOAD_GAME sanitizes corrupted save data
    # Subtest: Negative money in save is clamped to 0
    ok 1 - Negative money in save is clamped to 0
      ---
      duration_ms: 0.688764
      type: 'test'
      ...
    # Subtest: Harmony out of range is clamped
    ok 2 - Harmony out of range is clamped
      ---
      duration_ms: 0.427365
      type: 'test'
      ...
    # Subtest: Fuel overflow is clamped to 100
    ok 3 - Fuel overflow is clamped to 100
      ---
      duration_ms: 0.407105
      type: 'test'
      ...
    # Subtest: Missing fields get defaults
    ok 4 - Missing fields get defaults
      ---
      duration_ms: 0.44226
      type: 'test'
      ...
    # Subtest: Legacy energy modifier migrated to catering
    ok 5 - Legacy energy modifier migrated to catering
      ---
      duration_ms: 0.403158
      type: 'test'
      ...
    # Subtest: Day cannot be less than 1
    ok 6 - Day cannot be less than 1
      ---
      duration_ms: 0.423249
      type: 'test'
      ...
    1..6
ok 118 - Golden Path: LOAD_GAME sanitizes corrupted save data
  ---
  duration_ms: 3.513368
  type: 'test'
  ...
# Subtest: Golden Path: Scene sequence matches state machine
    # Subtest: All valid transitions produce the target scene
    ok 1 - All valid transitions produce the target scene
      ---
      duration_ms: 0.902239
      type: 'test'
      ...
    # Subtest: START_GIG transitions to PREGIG regardless of current scene
    ok 2 - START_GIG transitions to PREGIG regardless of current scene
      ---
      duration_ms: 0.209921
      type: 'test'
      ...
    1..2
ok 119 - Golden Path: Scene sequence matches state machine
  ---
  duration_ms: 1.416209
  type: 'test'
  ...
# Subtest: Golden Path: Daily cost scaling with band size
    # Subtest: Daily cost includes per-member component
    ok 1 - Daily cost includes per-member component
      ---
      duration_ms: 0.302984
      type: 'test'
      ...
    1..1
ok 120 - Golden Path: Daily cost scaling with band size
  ---
  duration_ms: 0.531387
  type: 'test'
  ...
# Subtest: Golden Path: Event cooldowns reset on ADVANCE_DAY
    # Subtest: Cooldowns cleared after day advance
    ok 1 - Cooldowns cleared after day advance
      ---
      duration_ms: 3.484123
      type: 'test'
      ...
    1..1
ok 121 - Golden Path: Event cooldowns reset on ADVANCE_DAY
  ---
  duration_ms: 3.671343
  type: 'test'
  ...
# Subtest: Golden Path: Gig stats snapshot structure
    # Subtest: buildGigStatsSnapshot includes all fields
    ok 1 - buildGigStatsSnapshot includes all fields
      ---
      duration_ms: 0.175699
      type: 'test'
      ...
    1..1
ok 122 - Golden Path: Gig stats snapshot structure
  ---
  duration_ms: 0.38644
  type: 'test'
  ...
# Subtest: HQ Items Data Integrity
    # Subtest: validates all gear items
    ok 1 - validates all gear items
      ---
      duration_ms: 1.311664
      type: 'test'
      ...
    # Subtest: validates all instrument items
    ok 2 - validates all instrument items
      ---
      duration_ms: 0.243751
      type: 'test'
      ...
    # Subtest: validates all van items
    ok 3 - validates all van items
      ---
      duration_ms: 0.224078
      type: 'test'
      ...
    # Subtest: validates all hq items
    ok 4 - validates all hq items
      ---
      duration_ms: 0.301854
      type: 'test'
      ...
    1..4
ok 123 - HQ Items Data Integrity
  ---
  duration_ms: 3.66847
  type: 'suite'
  ...
# Subtest: getGenImageUrl generates correct Pollinations.ai URL
ok 124 - getGenImageUrl generates correct Pollinations.ai URL
  ---
  duration_ms: 1.374669
  type: 'test'
  ...
# Subtest: IMG_PROMPTS contains expected keys and string values
ok 125 - IMG_PROMPTS contains expected keys and string values
  ---
  duration_ms: 0.279233
  type: 'test'
  ...
# (node:5290) ExperimentalWarning: Module mocking is an experimental feature and might change at any time
# (Use `node --trace-warnings ...` to show where the warning was created)
# Subtest: MainMenu starts ambient audio when starting a tour
ok 126 - MainMenu starts ambient audio when starting a tour
  ---
  duration_ms: 238.556395
  type: 'test'
  ...
# Subtest: MainMenu starts ambient audio when loading a save
ok 127 - MainMenu starts ambient audio when loading a save
  ---
  duration_ms: 78.382747
  type: 'test'
  ...
# Subtest: MapGenerator generates a map with correct structure
ok 128 - MapGenerator generates a map with correct structure
  ---
  duration_ms: 16.454231
  type: 'test'
  ...
# Subtest: MapGenerator guarantees start node
ok 129 - MapGenerator guarantees start node
  ---
  duration_ms: 10.908976
  type: 'test'
  ...
# Subtest: MapGenerator guarantees finale node
ok 130 - MapGenerator guarantees finale node
  ---
  duration_ms: 0.3423
  type: 'test'
  ...
# Subtest: MapGenerator connections are valid
ok 131 - MapGenerator connections are valid
  ---
  duration_ms: 0.464409
  type: 'test'
  ...
# Subtest: MapGenerator ensures nodes do not overlap
ok 132 - MapGenerator ensures nodes do not overlap
  ---
  duration_ms: 0.639853
  type: 'test'
  ...
# Duplicate found: MTC (Layer 2)
# Subtest: MapGenerator should not have duplicate venues (if possible)
ok 133 - MapGenerator should not have duplicate venues (if possible)
  ---
  duration_ms: 11.315578
  type: 'test'
  ...
# Subtest: isPercussionTrack
    # Subtest: detects percussion instrument metadata
    ok 1 - detects percussion instrument metadata
      ---
      duration_ms: 1.099767
      type: 'test'
      ...
    # Subtest: detects channel 9 percussion tracks
    ok 2 - detects channel 9 percussion tracks
      ---
      duration_ms: 0.238032
      type: 'test'
      ...
    # Subtest: returns false for non-percussion tracks
    ok 3 - returns false for non-percussion tracks
      ---
      duration_ms: 0.169638
      type: 'test'
      ...
    1..3
ok 134 - isPercussionTrack
  ---
  duration_ms: 2.985831
  type: 'test'
  ...
# Subtest: isValidMidiNote
    # Subtest: accepts finite MIDI pitches
    ok 1 - accepts finite MIDI pitches
      ---
      duration_ms: 0.283616
      type: 'test'
      ...
    # Subtest: rejects invalid MIDI pitches
    ok 2 - rejects invalid MIDI pitches
      ---
      duration_ms: 0.198858
      type: 'test'
      ...
    1..2
ok 135 - isValidMidiNote
  ---
  duration_ms: 1.219373
  type: 'test'
  ...
# Subtest: normalizeMidiPitch
    # Subtest: normalizes valid MIDI pitches
    ok 1 - normalizes valid MIDI pitches
      ---
      duration_ms: 0.272288
      type: 'test'
      ...
    # Subtest: returns null for invalid MIDI pitches
    ok 2 - returns null for invalid MIDI pitches
      ---
      duration_ms: 0.323376
      type: 'test'
      ...
    1..2
ok 136 - normalizeMidiPitch
  ---
  duration_ms: 1.457249
  type: 'test'
  ...
# Subtest: buildMidiTrackEvents
    # Subtest: filters invalid notes and normalizes pitches
    ok 1 - filters invalid notes and normalizes pitches
      ---
      duration_ms: 1.127838
      type: 'test'
      ...
    # Subtest: returns empty array for invalid input
    ok 2 - returns empty array for invalid input
      ---
      duration_ms: 0.131539
      type: 'test'
      ...
    1..2
ok 137 - buildMidiTrackEvents
  ---
  duration_ms: 1.591063
  type: 'test'
  ...
# Subtest: calculateNoteY returns target position at hit time
ok 138 - calculateNoteY returns target position at hit time
  ---
  duration_ms: 1.197271
  type: 'test'
  ...
# Subtest: calculateCrowdY offsets by combo intensity
ok 139 - calculateCrowdY offsets by combo intensity
  ---
  duration_ms: 0.307318
  type: 'test'
  ...
# Subtest: calculateLaneStartX centers lanes
ok 140 - calculateLaneStartX centers lanes
  ---
  duration_ms: 0.203054
  type: 'test'
  ...
# Subtest: buildRhythmLayout derives lane and hit line positions
ok 141 - buildRhythmLayout derives lane and hit line positions
  ---
  duration_ms: 0.240436
  type: 'test'
  ...
# Subtest: trySpawnProjectile respects spawn chance
ok 142 - trySpawnProjectile respects spawn chance
  ---
  duration_ms: 1.385533
  type: 'test'
  ...
# Subtest: trySpawnProjectile respects no spawn
ok 143 - trySpawnProjectile respects no spawn
  ---
  duration_ms: 0.242288
  type: 'test'
  ...
# Subtest: trySpawnProjectile increases chance on low health
ok 144 - trySpawnProjectile increases chance on low health
  ---
  duration_ms: 0.208055
  type: 'test'
  ...
# Subtest: updateProjectiles moves items correctly
ok 145 - updateProjectiles moves items correctly
  ---
  duration_ms: 0.269579
  type: 'test'
  ...
# Subtest: updateProjectiles removes off-screen items
ok 146 - updateProjectiles removes off-screen items
  ---
  duration_ms: 0.256056
  type: 'test'
  ...
# Subtest: updateProjectiles handles empty input
ok 147 - updateProjectiles handles empty input
  ---
  duration_ms: 0.818584
  type: 'test'
  ...
# Subtest: updateProjectiles handles large delta (lag spike)
ok 148 - updateProjectiles handles large delta (lag spike)
  ---
  duration_ms: 0.260871
  type: 'test'
  ...
# Subtest: checkHit finds matching note within window
ok 149 - checkHit finds matching note within window
  ---
  duration_ms: 2.215641
  type: 'test'
  ...
# Subtest: checkHit ignores notes outside window
ok 150 - checkHit ignores notes outside window
  ---
  duration_ms: 0.21778
  type: 'test'
  ...
# Subtest: checkHit ignores wrong lane
ok 151 - checkHit ignores wrong lane
  ---
  duration_ms: 0.16811
  type: 'test'
  ...
# Subtest: checkHit ignores already hit or invisible notes
ok 152 - checkHit ignores already hit or invisible notes
  ---
  duration_ms: 0.290633
  type: 'test'
  ...
# Subtest: checkHit prioritizes closest note?
ok 153 - checkHit prioritizes closest note?
  ---
  duration_ms: 0.198554
  type: 'test'
  ...
# Subtest: generateNotesForSong creates correct note structure
ok 154 - generateNotesForSong creates correct note structure
  ---
  duration_ms: 2.274382
  type: 'test'
  ...
# Subtest: generateNotesForSong respects difficulty
ok 155 - generateNotesForSong respects difficulty
  ---
  duration_ms: 0.358139
  type: 'test'
  ...
# Subtest: rhythm_songs.json integration
    # Subtest: all songs can be parsed without error
    ok 1 - all songs can be parsed without error
      ---
      duration_ms: 3.879083
      type: 'test'
      ...
    1..1
ok 156 - rhythm_songs.json integration
  ---
  duration_ms: 5.164348
  type: 'test'
  ...
# Subtest: rhythm_songs.json sourceOgg fields
    # Subtest: every song with sourceMid has a matching sourceOgg
    ok 1 - every song with sourceMid has a matching sourceOgg
      ---
      duration_ms: 0.433601
      type: 'test'
      ...
    1..1
ok 157 - rhythm_songs.json sourceOgg fields
  ---
  duration_ms: 0.753974
  type: 'test'
  ...
# Subtest: calculateTimeFromTicks logic
    # Subtest: calculates correct time with constant tempo
    ok 1 - calculates correct time with constant tempo
      ---
      duration_ms: 0.264994
      type: 'test'
      ...
    # Subtest: calculates correct time with tempo change
    ok 2 - calculates correct time with tempo change
      ---
      duration_ms: 0.176714
      type: 'test'
      ...
    # Subtest: handles empty map gracefully
    ok 3 - handles empty map gracefully
      ---
      duration_ms: 0.170708
      type: 'test'
      ...
    1..3
ok 158 - calculateTimeFromTicks logic
  ---
  duration_ms: 1.409279
  type: 'test'
  ...
# Subtest: getGigModifiers returns default modifiers for average band
ok 159 - getGigModifiers returns default modifiers for average band
  ---
  duration_ms: 1.626073
  type: 'test'
  ...
# Subtest: getGigModifiers grants telepathy bonus for high harmony
ok 160 - getGigModifiers grants telepathy bonus for high harmony
  ---
  duration_ms: 0.323335
  type: 'test'
  ...
# Subtest: getGigModifiers applies disconnect penalty for low harmony
ok 161 - getGigModifiers applies disconnect penalty for low harmony
  ---
  duration_ms: 0.235437
  type: 'test'
  ...
# Subtest: getGigModifiers has no special effects for mid harmony
ok 162 - getGigModifiers has no special effects for mid harmony
  ---
  duration_ms: 0.151233
  type: 'test'
  ...
# Subtest: getGigModifiers applies grumpy Matze penalty
ok 163 - getGigModifiers applies grumpy Matze penalty
  ---
  duration_ms: 0.303095
  type: 'test'
  ...
# Subtest: getGigModifiers does not apply Matze penalty when mood is okay
ok 164 - getGigModifiers does not apply Matze penalty when mood is okay
  ---
  duration_ms: 0.160641
  type: 'test'
  ...
# Subtest: getGigModifiers applies tired Lars speed increase
ok 165 - getGigModifiers applies tired Lars speed increase
  ---
  duration_ms: 0.244095
  type: 'test'
  ...
# Subtest: getGigModifiers does not apply Lars penalty when stamina is okay
ok 166 - getGigModifiers does not apply Lars penalty when stamina is okay
  ---
  duration_ms: 0.181084
  type: 'test'
  ...
# Subtest: getGigModifiers can apply multiple effects
ok 167 - getGigModifiers can apply multiple effects
  ---
  duration_ms: 0.484641
  type: 'test'
  ...
# Subtest: calculateGigPhysics returns physics object
ok 168 - calculateGigPhysics returns physics object
  ---
  duration_ms: 0.698544
  type: 'test'
  ...
# Subtest: calculateGigPhysics calculates hit windows based on skill
ok 169 - calculateGigPhysics calculates hit windows based on skill
  ---
  duration_ms: 0.201694
  type: 'test'
  ...
# Subtest: calculateGigPhysics skill increases hit windows
ok 170 - calculateGigPhysics skill increases hit windows
  ---
  duration_ms: 0.235359
  type: 'test'
  ...
# Subtest: calculateGigPhysics reduces speed for low stamina
ok 171 - calculateGigPhysics reduces speed for low stamina
  ---
  duration_ms: 0.167451
  type: 'test'
  ...
# Subtest: calculateGigPhysics normal speed for adequate stamina
ok 172 - calculateGigPhysics normal speed for adequate stamina
  ---
  duration_ms: 0.143186
  type: 'test'
  ...
# Subtest: calculateGigPhysics returns default multipliers
ok 173 - calculateGigPhysics returns default multipliers
  ---
  duration_ms: 0.19332
  type: 'test'
  ...
# Subtest: calculateGigPhysics applies blast machine trait for fast songs
ok 174 - calculateGigPhysics applies blast machine trait for fast songs
  ---
  duration_ms: 0.176549
  type: 'test'
  ...
# Subtest: calculateGigPhysics does not apply blast machine for slow songs
ok 175 - calculateGigPhysics does not apply blast machine for slow songs
  ---
  duration_ms: 0.159381
  type: 'test'
  ...
# Subtest: calculateGigPhysics includes avgStamina in result
ok 176 - calculateGigPhysics includes avgStamina in result
  ---
  duration_ms: 0.15176
  type: 'test'
  ...
# Subtest: calculateGigPhysics handles missing member gracefully
ok 177 - calculateGigPhysics handles missing member gracefully
  ---
  duration_ms: 0.153035
  type: 'test'
  ...
# Subtest: calculateGigPhysics handles missing skill property
ok 178 - calculateGigPhysics handles missing skill property
  ---
  duration_ms: 0.205544
  type: 'test'
  ...
# Subtest: Game Loop Logic Simulation
    # Subtest: Phase 1: Travel (Overworld)
    ok 1 - Phase 1: Travel (Overworld)
      ---
      duration_ms: 1.37112
      type: 'test'
      ...
    # Subtest: Phase 2: Refuel (Overworld)
    ok 2 - Phase 2: Refuel (Overworld)
      ---
      duration_ms: 0.240312
      type: 'test'
      ...
    # Subtest: Phase 3: Gig (PostGig)
    ok 3 - Phase 3: Gig (PostGig)
      ---
      duration_ms: 0.383292
      type: 'test'
      ...
    # Subtest: Phase 4: Next Travel Cycle
    ok 4 - Phase 4: Next Travel Cycle
      ---
      duration_ms: 0.306641
      type: 'test'
      ...
    1..4
ok 179 - Game Loop Logic Simulation
  ---
  duration_ms: 4.079753
  type: 'test'
  ...
# Subtest: calculateViralityScore returns base chance for average performance
ok 180 - calculateViralityScore returns base chance for average performance
  ---
  duration_ms: 1.630016
  type: 'test'
  ...
# Subtest: calculateViralityScore increases with high performance
ok 181 - calculateViralityScore increases with high performance
  ---
  duration_ms: 0.320279
  type: 'test'
  ...
# Subtest: calculateViralityScore applies performance multipliers
ok 182 - calculateViralityScore applies performance multipliers
  ---
  duration_ms: 0.190602
  type: 'test'
  ...
# Subtest: calculateViralityScore boosts for Kaminstube venue
ok 183 - calculateViralityScore boosts for Kaminstube venue
  ---
  duration_ms: 0.15108
  type: 'test'
  ...
# Subtest: calculateViralityScore boosts for stage diver event
ok 184 - calculateViralityScore boosts for stage diver event
  ---
  duration_ms: 1.874935
  type: 'test'
  ...
# Subtest: calculateViralityScore boosts for influencer event
ok 185 - calculateViralityScore boosts for influencer event
  ---
  duration_ms: 0.200458
  type: 'test'
  ...
# Subtest: calculateViralityScore is capped at 90%
ok 186 - calculateViralityScore is capped at 90%
  ---
  duration_ms: 0.212889
  type: 'test'
  ...
# Subtest: calculateViralityScore combines multiple bonuses
ok 187 - calculateViralityScore combines multiple bonuses
  ---
  duration_ms: 0.264578
  type: 'test'
  ...
# Subtest: generatePostOptions returns array of options
ok 188 - generatePostOptions returns array of options
  ---
  duration_ms: 0.498925
  type: 'test'
  ...
# Subtest: generatePostOptions includes moshpit option
ok 189 - generatePostOptions includes moshpit option
  ---
  duration_ms: 0.560952
  type: 'test'
  ...
# Subtest: generatePostOptions includes technical option
ok 190 - generatePostOptions includes technical option
  ---
  duration_ms: 0.229981
  type: 'test'
  ...
# Subtest: generatePostOptions includes band pic option
ok 191 - generatePostOptions includes band pic option
  ---
  duration_ms: 0.157808
  type: 'test'
  ...
# Subtest: generatePostOptions scales mosh viral chance
ok 192 - generatePostOptions scales mosh viral chance
  ---
  duration_ms: 0.169638
  type: 'test'
  ...
# Subtest: generatePostOptions all have required properties
ok 193 - generatePostOptions all have required properties
  ---
  duration_ms: 0.152052
  type: 'test'
  ...
# Subtest: resolvePost handles viral success
ok 194 - resolvePost handles viral success
  ---
  duration_ms: 0.244491
  type: 'test'
  ...
# Subtest: resolvePost handles non-viral post
ok 195 - resolvePost handles non-viral post
  ---
  duration_ms: 0.285938
  type: 'test'
  ...
# Subtest: resolvePost viral multiplies by 10
ok 196 - resolvePost viral multiplies by 10
  ---
  duration_ms: 0.132403
  type: 'test'
  ...
# Subtest: resolvePost handles edge case of 0 base followers
ok 197 - resolvePost handles edge case of 0 base followers
  ---
  duration_ms: 0.118414
  type: 'test'
  ...
# Subtest: resolvePost threshold at exact viral chance
ok 198 - resolvePost threshold at exact viral chance
  ---
  duration_ms: 0.110997
  type: 'test'
  ...
# Subtest: resolvePost preserves all platforms
ok 199 - resolvePost preserves all platforms
  ---
  duration_ms: 0.142976
  type: 'test'
  ...
# Subtest: resolvePost returns consistent structure
ok 200 - resolvePost returns consistent structure
  ---
  duration_ms: 0.145198
  type: 'test'
  ...
# Subtest: calculateViralityScore handles low performance
ok 201 - calculateViralityScore handles low performance
  ---
  duration_ms: 0.143882
  type: 'test'
  ...
# Subtest: generatePostOptions viral chances are reasonable
ok 202 - generatePostOptions viral chances are reasonable
  ---
  duration_ms: 0.153304
  type: 'test'
  ...
1..202
# tests 355
# suites 42
# pass 352
# fail 0
# cancelled 0
# skipped 3
# todo 0
# duration_ms 5677.178094
