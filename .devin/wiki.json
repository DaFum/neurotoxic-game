{
  "repo_notes": [
    {
      "content": "Use Standard limits (not Enterprise): keep this plan at or under 30 pages and 100 total notes. Prefer complete system navigation with precise technical intent over broad generic page descriptions.",
      "author": "Docs Maintainer"
    },
    {
      "content": "Prioritize inspection order: src/utils/audioEngine.js (initAudioEngine, loadSongAudio, startGigPlayback, stopAudioInternal), src/utils/AudioManager.js (singleton lifecycle), src/context/GameState.jsx (GameStateProvider, useGameState), src/context/gameReducer.js (ActionTypes, gameReducer), src/hooks/useRhythmGameLogic.js, src/hooks/useTravelLogic.js, src/hooks/usePurchaseLogic.js, src/components/PixiStageController.js, then src/ui and src/data.",
      "author": "Architecture"
    },
    {
      "content": "Cross-module relationships must be explicit: scenes dispatch via useGameState() helpers such as changeScene(); hooks call pure utilities like calculateGigFinancials(), calculateTravelExpenses(), checkEvent(), and calculateDailyUpdates(); data from src/data/events/, venues.js, songs.js, upgrades.js, and hqItems.js defines runtime content for UI and gameplay.",
      "author": "Architecture"
    },
    {
      "content": "Always include constraints and risks: React 18 + Vite 5 + Tailwind v4 pinning, Tailwind v4 syntax rules from docs/TAILWIND_V4_PATTERNS.md, CSS variable color policy in src/index.css, state safety rules player.money >= 0 and band.harmony > 0, AudioContext gesture constraints via ensureAudioContext(), and localStorage tampering risk handled through safeStorageOperation wrappers.",
      "author": "Quality"
    },
    {
      "content": "Deprioritize dist/, node_modules/, and generated files. If space is needed, consolidate low-priority implementation details into page_notes under parent architecture pages rather than creating more top-level pages.",
      "author": "Quality"
    }
  ],
  "pages": [
    {
      "title": "Overview",
      "purpose": "Build the canonical landing page for the documentation set, linking docs/ARCHITECTURE.md, docs/STATE_TRANSITIONS.md, README.md setup commands, src/context/GameState.jsx, src/context/gameReducer.js, src/utils/AudioManager.js, src/utils/audioEngine.js, src/hooks/useRhythmGameLogic.js, src/scenes/Gig.jsx, and src/components/PixiStageController.js so contributors can jump from concept to implementation in one hop.",
      "page_notes": [
        {
          "content": "Explain the full gameplay loop as implemented by src/scenes/Overworld.jsx -> src/scenes/PreGig.jsx -> src/scenes/Gig.jsx -> src/scenes/PostGig.jsx with scene changes initiated through GameState actions."
        },
        {
          "content": "Include a short map from high-level sections to files so first-time contributors know where to start reading code."
        },
        {
          "content": "Add a subsection that maps each wiki page to one owning folder to reduce overlap and duplicated explanations."
        },
        {
          "content": "Call out AGENTS.md precedence rules so contributors check nested guidance before editing scoped modules."
        }
      ]
    },
    {
      "title": "Purpose and Scope",
      "purpose": "Define documentation boundaries using README.md and docs/CODING_STANDARDS.md: frontend-only SPA architecture (no backend/API layer), gameplay scope, ownership of React scenes/hooks/utils/ui modules, and explicit non-goals such as documenting dist/ or node_modules/. Include persistence scope through src/utils/storage.js and what is intentionally out of threat-model guarantees.",
      "parent": "Overview",
      "page_notes": [
        {
          "content": "Call out that persistence does not include encryption and should be treated as user-modifiable state."
        },
        {
          "content": "State that documentation should emphasize why systems exist and how they interact, not only API signatures."
        }
      ]
    },
    {
      "title": "Game Concept",
      "purpose": "Document the player loop with file-level anchors: travel decisions in src/scenes/Overworld.jsx and src/hooks/useTravelLogic.js, gig preparation in src/scenes/PreGig.jsx, rhythm execution in src/scenes/Gig.jsx via useRhythmGameLogic(), and outcome application in src/scenes/PostGig.jsx using calculateGigFinancials(), resolvePost(), and reducer updates for money/fuel/harmony/followers.",
      "parent": "Overview",
      "page_notes": [
        {
          "content": "Describe strategic pressure around money, fuel, and harmony and where these values are consumed by utility functions in src/utils/economyEngine.js and src/utils/simulationUtils.js."
        },
        {
          "content": "Include one worked example tour day showing travel cost, event trigger, gig result, and post-gig stat changes."
        }
      ]
    },
    {
      "title": "Scene Flow & Game Loop",
      "purpose": "Describe exact scene transition mechanics implemented through createChangeSceneAction() in src/context/actionCreators.js, changeScene() from useGameState() in src/context/GameState.jsx, and ActionTypes.CHANGE_SCENE handling in src/context/gameReducer.js for MENU, SETTINGS, CREDITS, OVERWORLD, PREGIG, GIG, POSTGIG, and GAMEOVER.",
      "parent": "Overview",
      "page_notes": [
        {
          "content": "Reference docs/STATE_TRANSITIONS.md for the canonical state-machine narrative and note differences if implementation diverges."
        },
        {
          "content": "List transition triggers: travel completion, gig start, gig end, event modal resolution, and game-over conditions."
        },
        {
          "content": "Document failure transitions into GAMEOVER and recovery/return paths back to MENU after credits or restart."
        }
      ]
    },
    {
      "title": "Main Menu",
      "purpose": "Deep dive src/scenes/MainMenu.jsx as boot entry: user-gesture audio bootstrap via ensureAudioContext()/AudioManager startup methods, continue-game hydration via storage load helpers, dispatch of initial map/tour actions, and navigation routing to SETTINGS/CREDITS/OVERWORLD through GameState scene actions.",
      "parent": "Scene Flow & Game Loop",
      "page_notes": [
        {
          "content": "Mention browser autoplay policy and how ensureAudioContext() or equivalent guard paths avoid silent startup failures."
        }
      ]
    },
    {
      "title": "Tech Stack",
      "purpose": "Record dependency roles with explicit package.json anchors: react/react-dom 18.2.0 for UI, vite 5.x for dev/build, pixi.js 8 for canvas rendering, tone 15.x for audio graph/scheduling, tailwindcss 4.x for utility styling, and framer-motion 12.x for animated UI transitions. Explain why React/Vite/Tailwind pinning is mandatory for compatibility.",
      "parent": "Overview",
      "page_notes": [
        {
          "content": "State non-negotiable pinning: do not upgrade React, Vite, or Tailwind without dedicated migration documentation updates."
        },
        {
          "content": "Mention Node.js runtime requirement used by tests/build and where it is declared or implied in tooling."
        }
      ]
    },
    {
      "title": "Project Structure",
      "purpose": "Map repository structure to runtime behavior with concrete examples: src/main.jsx app mount, src/context reducers/actions, src/hooks orchestration hooks, src/scenes route-level containers, src/utils pure engines and audio services, src/components Pixi controllers/overlays, src/ui reusable design-system widgets, tests/ node:test suites, and docs/ architecture references.",
      "parent": "Overview",
      "page_notes": [
        {
          "content": "Point to tests/ as the verification layer and map each major utility module to its corresponding test file when available."
        }
      ]
    },
    {
      "title": "System Architecture",
      "purpose": "Explain layered flow end-to-end: GameStateProvider/useReducer as state core (src/context/*), hooks as orchestration layer (useTravelLogic, usePurchaseLogic, useRhythmGameLogic), utility engines as deterministic calculators (economyEngine, eventEngine, simulationUtils), and rendering split between React scene composition and PixiStageController frame updates.",
      "parent": "Overview",
      "page_notes": [
        {
          "content": "Explicitly separate side-effect boundaries (audio, storage, timers) from pure calculation modules to guide maintainable changes."
        },
        {
          "content": "Document how action creators in src/context/actionCreators.js are preferred over ad-hoc dispatch object literals."
        },
        {
          "content": "Include a small dependency-direction rule: scenes -> hooks/context -> utils/data; avoid reverse imports from utility modules into scenes."
        }
      ]
    },
    {
      "title": "Core Subsystems Overview",
      "purpose": "Provide a subsystem dependency map that names primary files and key functions: AudioManager + audioEngine playback lifecycle, GameStateProvider + gameReducer state transitions, useRhythmGameLogic timing loop, PixiStageController render/update cycle, calculateGigFinancials()/calculateTravelExpenses() economy pipeline, mapGenerator travel topology, and checkEvent()/triggerEvent() event resolution.",
      "parent": "Overview",
      "page_notes": [
        {
          "content": "Keep this page architecture-focused; push low-priority details into child page_notes to conserve page budget."
        },
        {
          "content": "Tag each subsystem with maintenance risk level (low/medium/high) and quick rationale to guide onboarding priorities."
        }
      ]
    },
    {
      "title": "Audio Engine Core",
      "purpose": "Deep dive src/utils/audioEngine.js (~1900 lines): Tone.js boot sequence via setupAudio()/initAudioEngine with Tone.Context timing parameters, instrument chains for guitar/bass/drums/SFX/clean-MIDI buses, routing through compressor/limiter/musicGain nodes, playback entry points loadSongAudio(), playAmbientTrack(), startGigPlayback(), and teardown via stopGigPlayback()/stopAudioInternal() with disposal guarantees and failure modes.",
      "parent": "Core Subsystems Overview",
      "page_notes": [
        {
          "content": "Document four playback fallback modes (OGG -> MIDI -> note data -> procedural) and when each path is chosen."
        },
        {
          "content": "Call out disposal guarantees and known cleanup caveats around layered instrument nodes and exception safety during teardown."
        },
        {
          "content": "Include expected parameter defaults for critical synth/effect nodes and where deviations are introduced by song metadata."
        }
      ]
    },
    {
      "title": "Rhythm Game Logic",
      "purpose": "Document src/hooks/useRhythmGameLogic.js at function level: note scheduling from song data, lane-state mutation via refs, hit-window judgment and scoring/combo math, miss/penalty handling, pause/resume/finish transitions, and synchronization boundaries with src/components/PixiStageController.js and src/components/GigHUD.jsx under mixed Tone/WebAudio clocks.",
      "parent": "Core Subsystems Overview",
      "page_notes": [
        {
          "content": "Explain timing sources (AudioContext.currentTime, Tone.now(), or game clock refs) and how drift is mitigated between audio and visual lanes."
        },
        {
          "content": "Include where gameplay output is written back to state for post-gig calculations."
        },
        {
          "content": "Specify how hit-judgment windows scale (or do not scale) with difficulty and where those constants are defined."
        }
      ]
    },
    {
      "title": "Pixi Rendering Pipeline",
      "purpose": "Describe rendering internals across src/components/PixiStageController.js and src/components/PixiStage.jsx: ticker/frame callbacks, lane/note sprite lifecycle, world-to-screen coordinate transforms, HUD overlay interoperability, and unmount cleanup (destroy textures, remove listeners, stop ticker) required to avoid memory leaks and stale refs between gigs.",
      "parent": "Core Subsystems Overview",
      "page_notes": [
        {
          "content": "Document cleanup expectations on scene unmount to prevent ticker leaks, retained textures, and stale refs."
        },
        {
          "content": "Describe z-order/layer strategy for lanes, notes, hit line, and transient feedback effects to avoid rendering regressions."
        }
      ]
    },
    {
      "title": "State Management",
      "purpose": "Document full state architecture in src/context/GameState.jsx and src/context/gameReducer.js: ActionTypes taxonomy, reducer branches for player/band/social/gig/map/toast/event slices, action creator contracts from src/context/actionCreators.js, and enforcement points for invariants player.money >= 0 and band.harmony > 0 during state updates.",
      "parent": "Core Subsystems Overview",
      "page_notes": [
        {
          "content": "Include invariants for money and harmony and where guards are enforced before/after updates."
        },
        {
          "content": "List reducer actions that can affect economy stats to simplify auditing for money/harmony invariant safety."
        }
      ]
    },
    {
      "title": "GameState Context",
      "purpose": "Detail GameStateProvider and useGameState() API surface: exposed state slices, dispatch helpers (changeScene, triggerEvent, addToast, setGigModifiers), memoization boundaries, and consumer usage patterns in scenes/hooks. Reference where provider wires persistence load/save hooks and how transient runtime fields are excluded from serialized payloads.",
      "parent": "State Management",
      "page_notes": [
        {
          "content": "Clarify which parts of state are persisted versus runtime-only transient fields."
        },
        {
          "content": "Document expected consumer pattern in scenes/hooks to avoid direct mutation and stale closures."
        },
        {
          "content": "Document recommended selector/memo usage patterns to minimize unnecessary rerenders in scene components."
        }
      ]
    },
    {
      "title": "Persistence & Save Data",
      "purpose": "Document persistence flow in src/utils/storage.js and GameState load/save integration: safeStorageOperation wrappers, schema/version handling, reducer load actions, fallback behavior on parse failures, and guardrails against malformed/tampered localStorage data before applying values to player economy or band condition.",
      "parent": "State Management",
      "page_notes": [
        {
          "content": "Highlight tampering risk, schema drift concerns, and recommended validation checks before applying persisted values."
        },
        {
          "content": "Add migration guidance for future save schema versions, including defaulting rules for newly introduced fields."
        }
      ]
    },
    {
      "title": "Economy & Resources",
      "purpose": "Explain lifecycle of money/fuel/harmony/fame/followers across travel and gigs, linking src/utils/economyEngine.js, src/utils/simulationUtils.js, src/scenes/Overworld.jsx, and src/scenes/PostGig.jsx. Include where daily costs, refuel spend, gig payouts, and modifiers are calculated and how results dispatch through reducer updates.",
      "parent": "Core Subsystems Overview",
      "page_notes": [
        {
          "content": "Provide a summary table of all resource producers/consumers (travel, refuel, events, gig payouts, purchases)."
        }
      ]
    },
    {
      "title": "Economy Engine",
      "purpose": "Provide contract-level documentation for src/utils/economyEngine.js functions including calculateGigFinancials(), calculateTravelExpenses(), and supporting helpers: required input shape, output breakdown fields, rounding/normalization rules, and call sites in travel/post-gig flows that enforce no-negative-money constraints and progression balance.",
      "parent": "Economy & Resources",
      "page_notes": [
        {
          "content": "Include edge-case behavior for low-resource states and how negative balances are prevented or corrected."
        },
        {
          "content": "Include examples of expected output for typical gig, low attendance gig, and high bonus gig scenarios."
        }
      ]
    },
    {
      "title": "Travel & Movement",
      "purpose": "Document route traversal implementation in src/hooks/useTravelLogic.js + src/utils/mapGenerator.js: graph/node creation, path progression ticks, day advancement, fuel burn, travel completion events, and integration with calculateDailyUpdates() plus random encounter checks from eventEngine during movement.",
      "parent": "Core Subsystems Overview",
      "page_notes": [
        {
          "content": "Point to functions that compute daily updates and explain when travel tick side effects are dispatched."
        },
        {
          "content": "Document how map node metadata influences event probability or travel outcomes if modifiers are present."
        }
      ]
    },
    {
      "title": "Event Engine & Effect Semantics",
      "purpose": "Deep dive src/utils/eventEngine.js behavior around checkEvent(), triggerEvent(), and processEffect()-style reducers, with schema sourced from src/data/events/index.js and category files. Specify alias mappings, accumulation vs overwrite semantics for composite effects, and deterministic testing patterns from tests/eventEngine.test.js using mocked randomness.",
      "parent": "Core Subsystems Overview",
      "page_notes": [
        {
          "content": "Call out alias mapping behavior and whether repeated effect keys accumulate or overwrite during composite event resolution."
        },
        {
          "content": "Include deterministic testing strategy using mocked random values from tests/eventEngine.test.js."
        },
        {
          "content": "Include guardrails for adding new effect keys so unknown keys fail safely or are ignored deterministically."
        }
      ]
    },
    {
      "title": "Purchases & Upgrades",
      "purpose": "Document upgrade progression architecture across src/hooks/usePurchaseLogic.js, src/data/upgrades.js, src/data/hqItems.js, and UI consumers like src/ui/UpgradeMenu.jsx: category models, unlock requirements, ownership state, affordability gates, side effects on stats/resources, and reducer actions used to persist purchases.",
      "parent": "Overview",
      "page_notes": [
        {
          "content": "Consolidate low-priority item-by-item catalog details into this page instead of creating separate pages for each category."
        },
        {
          "content": "Add note on balancing philosophy: upgrades should create trade-offs, not always-dominant purchase paths."
        }
      ]
    },
    {
      "title": "Purchase Logic Hook",
      "purpose": "Provide function-by-function documentation for src/hooks/usePurchaseLogic.js including canAfford(), isItemOwned(), isItemDisabled(), purchase handlers, and emitted toast/error states. Include expected input contracts from shop UI components and safe handling of race conditions or stale state snapshots during rapid purchases.",
      "parent": "Purchases & Upgrades",
      "page_notes": [
        {
          "content": "Include expected integration contract for shop UI components in src/ui/UpgradeMenu.jsx and related panels."
        },
        {
          "content": "Document how the hook reports errors/toasts when affordability changes between render and click time."
        }
      ]
    },
    {
      "title": "UI System & Visual Language",
      "purpose": "Document design-system primitives in src/ui/ and src/ui/shared/: GlitchButton, HUD, EventModal, ToastOverlay, SettingsPanel, VolumeSlider, and layout panels. Tie implementation to src/index.css tokens (--toxic-green, --void-black, --blood-red), typography variables, CRT toggle behavior, and Tailwind v4 utility patterns required by docs/TAILWIND_V4_PATTERNS.md.",
      "parent": "Overview",
      "page_notes": [
        {
          "content": "Explicitly enforce no hardcoded colors in components; reference --toxic-green, --void-black, --blood-red, and related tokens from the theme."
        },
        {
          "content": "Include CRT overlay behavior controlled by settings.crtEnabled and where that setting is read."
        },
        {
          "content": "Add explicit spacing/layout conventions used in panels and HUD to keep brutalist composition consistent."
        }
      ]
    },
    {
      "title": "Data & Content",
      "purpose": "Explain content data contracts across src/data/events/*, src/data/venues.js, src/data/songs.js, src/data/characters.js, src/data/chatter.js, src/data/upgrades.js, and src/data/hqItems.js: unique ID requirements, shape expectations, duplicate validation in events index, and the runtime consumers (hooks/scenes/utils) that depend on each structure.",
      "parent": "Overview",
      "page_notes": [
        {
          "content": "Cover event category files under src/data/events/ and how duplicate ID validation in the index aggregator protects runtime behavior."
        },
        {
          "content": "Add contributor checklist for new songs/events: ID uniqueness, required fields, and playtest/test expectations."
        }
      ]
    },
    {
      "title": "Code Entity Map",
      "purpose": "Create a symbol index with exact file/function anchors for rapid onboarding: GameStateProvider/useGameState, ActionTypes/gameReducer branches, createChangeSceneAction, useRhythmGameLogic handlers, useTravelLogic transitions, usePurchaseLogic predicates, calculateGigFinancials/calculateTravelExpenses, checkEvent/triggerEvent, and setupAudio/initAudioEngine entry points.",
      "parent": "Overview",
      "page_notes": [
        {
          "content": "Keep the map concise and link each symbol to one primary source file to reduce navigation friction."
        },
        {
          "content": "Include quick links for top 10 most edited files to accelerate triage during bugfix work."
        }
      ]
    },
    {
      "title": "Security & Threat Model",
      "purpose": "Map risks from neurotoxic-game-threat-model.md to code-level controls: AudioContext autoplay restrictions handled by ensureAudioContext() flows, localStorage tampering exposure and safeStorageOperation mitigations, reducer-safe defaults for malformed data, and scene-level fail-safe behavior to prevent hard crashes during startup/load/resume paths.",
      "parent": "Overview",
      "page_notes": [
        {
          "content": "Classify risks by severity and map each mitigation to specific functions/files where controls are implemented."
        },
        {
          "content": "Note expected behavior when tampered saves produce out-of-range values (clamp, reject, or reset strategy)."
        }
      ]
    },
    {
      "title": "Development & Testing",
      "purpose": "Document the QA pipeline from package.json scripts and CI expectations: eslint checks (npm run lint), node:test + tsx suites (npm run test), production build verification (npm run build), optional Playwright flows (npm run test:e2e), and module-level test authoring patterns for hooks/utils in tests/.",
      "parent": "Overview",
      "page_notes": [
        {
          "content": "Include node:test + tsx execution details and how to run targeted test files for utility modules."
        },
        {
          "content": "Add guidance for when to run e2e tests vs unit tests and which changes mandate build verification."
        }
      ]
    },
    {
      "title": "Project Configuration",
      "purpose": "Detail configuration surfaces and their responsibilities: package.json scripts/deps, vite.config.js base/react plugin behavior, biome.json style settings, postcss/tailwind integration, playwright.config.js e2e harness, and lint/format policy. Include explicit compatibility constraints and migration cautions for React 18/Vite 5/Tailwind v4.",
      "parent": "Development & Testing",
      "page_notes": [
        {
          "content": "Mention production audio constraints (HTTPS/mixed-content considerations) and CI expectations from workflow files under .github/."
        },
        {
          "content": "Document which config files are authoritative when settings overlap (eslint vs biome vs prettier)."
        }
      ]
    },
    {
      "title": "Development Workflow",
      "purpose": "Describe contributor workflow with concrete checkpoints: npm install, npm run dev at localhost:5173, implement change in scoped module, run npm run lint + npm run test + npm run build, verify docs updates (including AGENTS.md when rules change), and craft Conventional Commit messages that mention impacted subsystems/functions.",
      "parent": "Overview",
      "page_notes": [
        {
          "content": "Add a concise pre-PR checklist that mirrors AGENTS.md requirements and references docs/CODING_STANDARDS.md."
        },
        {
          "content": "Include release-readiness checks for documentation freshness in docs/ and AGENTS.md when architecture changes."
        }
      ]
    }
  ]
}
